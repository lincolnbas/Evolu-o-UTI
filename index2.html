<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolu√ß√£o M√©dica - UTI</title>
    <!-- Bibliotecas para funcionalidades avan√ßadas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .form-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .form-header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .form-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .form-header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .form-content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #e8ecf0;
            border-radius: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            transition: all 0.3s ease;
        }

        .section:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.15);
        }

        .section-title {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: "üìã";
            font-size: 1.2em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .form-col {
            flex: 1;
            min-width: 250px;
        }

        .form-col-small {
            flex: 0 0 150px;
            min-width: 150px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        input[type="text"], 
        input[type="number"], 
        input[type="date"], 
        textarea, 
        select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        input[type="text"]:focus, 
        input[type="number"]:focus, 
        input[type="date"]:focus, 
        textarea:focus, 
        select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            transform: translateY(-1px);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .radio-group, .checkbox-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .radio-item, .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .radio-item:hover, .checkbox-item:hover {
            border-color: #3498db;
            background: #f8f9ff;
            transform: translateY(-1px);
        }

        .radio-item input, .checkbox-item input {
            width: auto;
            margin: 0;
        }

        .conditional-field {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            display: none;
        }

        .conditional-field.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .submit-container {
            text-align: center;
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
        }

        .submit-btn {
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .required {
            color: #e74c3c;
        }

        .sofa-score {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
        }

        .sofa-score h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .sofa-score .score {
            font-size: 2.5em;
            font-weight: bold;
        }

        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #2c3e50;
            background: #e8f4fd;
        }

        .upload-area.dragover {
            border-color: #27ae60;
            background: #e8f5e8;
        }

        .quick-actions {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .quick-btn {
            padding: 10px 15px;
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(52, 152, 219, 0.3);
        }

        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        .suggestion-box {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .suggestion-box h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .suggestion-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid rgba(255, 255, 255, 0.3);
        }

        .suggestion-item h4 {
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .suggestion-item ul {
            margin-left: 20px;
        }

        .auto-save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(46, 204, 113, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            display: none;
            z-index: 1000;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e8ecf0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .template-selector {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .template-btn {
            background: white;
            border: 2px solid #3498db;
            color: #3498db;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-btn:hover {
            background: #3498db;
            color: white;
        }

        .keyboard-shortcuts {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(44, 62, 80, 0.9);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            display: none;
            z-index: 1000;
        }

        .validation-error {
            border-color: #e74c3c !important;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1) !important;
        }

        .validation-success {
            border-color: #27ae60 !important;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1) !important;
        }

        .dashboard-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
            color: white;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .dashboard-header h2 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .chart-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            color: white;
        }

        .chart-canvas {
            position: relative;
            height: 300px;
        }

        .trend-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #2c3e50;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .trend-up { background: rgba(231, 76, 60, 0.9) !important; color: white !important; }
        .trend-down { background: rgba(39, 174, 96, 0.9) !important; color: white !important; }
        .trend-stable { background: rgba(241, 196, 15, 0.9) !important; color: white !important; }

        .evolution-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .date-selector {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 10px 15px;
            color: white;
            outline: none;
        }

        .chart-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .chart-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .chart-btn.active {
            background: rgba(52, 152, 219, 0.8);
            border-color: #3498db;
        }

        .alert-panel {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            color: white;
        }

        .alert-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid rgba(255, 255, 255, 0.5);
        }

        .alert-item h4 {
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .export-section {
            text-align: center;
            margin-top: 30px;
        }

        .export-btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            margin: 0 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .tabs-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .tab-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 12px 25px;
            cursor: pointer;
            border-radius: 25px 25px 0 0;
            margin: 0 2px;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: rgba(255, 255, 255, 0.3);
            border-bottom: 3px solid #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .evolution-controls {
                flex-direction: column;
            }
            
            .dashboard-container {
                padding: 15px;
            }
        }

        @media (max-width: 768px) {
            .form-content {
                padding: 20px;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .radio-group, .checkbox-group {
                flex-direction: column;
            }
            
            .form-header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="form-header">
            <h1>üè• Evolu√ß√£o M√©dica - UTI</h1>
            <p>Formul√°rio Completo de Acompanhamento do Paciente</p>
        </div>

        <div class="form-content">
            <!-- Barra de progresso -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <!-- Templates r√°pidos -->
            <div class="template-selector">
                <h3 style="margin-bottom: 10px; color: #2c3e50;">üöÄ Templates R√°pidos</h3>
                <button type="button" class="template-btn" onclick="aplicarTemplate('pos_operatorio')">P√≥s-Operat√≥rio</button>
                <button type="button" class="template-btn" onclick="aplicarTemplate('sepse')">Sepse</button>
                <button type="button" class="template-btn" onclick="aplicarTemplate('ira')">IRA</button>
                <button type="button" class="template-btn" onclick="aplicarTemplate('vm')">Ventila√ß√£o Mec√¢nica</button>
                <button type="button" class="template-btn" onclick="aplicarTemplate('trauma')">Trauma</button>
            </div>

            <!-- Upload de exames -->
            <div class="section">
                <h2 class="section-title">üìÑ Upload de Exames (PDF)</h2>
                <div class="upload-area" id="uploadArea">
                    <div>
                        <p><strong>üìÅ Arraste arquivos PDF aqui ou clique para selecionar</strong></p>
                        <p>Suporta: Exames laboratoriais, relat√≥rios m√©dicos</p>
                        <input type="file" id="fileInput" accept=".pdf" multiple style="display: none;">
                    </div>
                </div>
                <div id="uploadStatus"></div>
                
                <!-- Debug Panel para PDF -->
                <div id="pdfDebugPanel" style="display: none; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #17a2b8;">
                    <h4 style="color: #17a2b8; margin-bottom: 10px;">üîç Debug - Texto Extra√≠do do PDF</h4>
                    <textarea id="pdfExtractedText" readonly style="width: 100%; height: 200px; font-family: monospace; font-size: 12px; border: 1px solid #ddd; padding: 10px;"></textarea>
                    <div style="margin-top: 10px;">
                        <button type="button" onclick="toggleDebugPanel()" style="background: #17a2b8; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">Ocultar Debug</button>
                        <button type="button" onclick="reprocessarTexto()" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-left: 10px;">Reprocessar</button>
                        <button type="button" onclick="testarPDFSimulado()" style="background: #fd7e14; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-left: 10px;">Testar PDF Simulado</button>
                    </div>
                </div>

                <!-- Dicas de uso -->
                <div style="margin-top: 15px; padding: 10px; background: #e8f4f8; border-radius: 8px; border-left: 3px solid #17a2b8;">
                    <h5 style="color: #17a2b8; margin: 0 0 8px 0;">üí° Dicas para melhor reconhecimento:</h5>
                    <ul style="margin: 0; padding-left: 20px; font-size: 14px;">
                        <li>PDFs gerados digitalmente funcionam melhor que scaneados</li>
                        <li>Formatos suportados: Fleury, Dasa, Hermes Pardini, Einstein, etc.</li>
                        <li>Use o bot√£o "Testar PDF Simulado" para verificar se a funcionalidade est√° funcionando</li>
                        <li>O painel de debug mostra exatamente o que foi extra√≠do do PDF</li>
                    </ul>
                </div>
            </div>

            <form id="evolucaoForm">
                <!-- 1. Dados de Identifica√ß√£o e Interna√ß√£o -->
                <div class="section">
                    <h2 class="section-title">Dados de Identifica√ß√£o e Interna√ß√£o</h2>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="nome">Nome do Paciente <span class="required">*</span></label>
                            <input type="text" id="nome" name="nome" required>
                        </div>
                        <div class="form-col-small">
                            <label for="idade">Idade <span class="required">*</span></label>
                            <input type="number" id="idade" name="idade" min="0" max="150" required>
                        </div>
                        <div class="form-col">
                            <label for="dataInternacao">Data de Interna√ß√£o na UTI <span class="required">*</span></label>
                            <input type="date" id="dataInternacao" name="dataInternacao" required>
                        </div>
                    </div>
                </div>

                <!-- 2. Motivo da Interna√ß√£o na UTI -->
                <div class="section">
                    <h2 class="section-title">Motivo da Interna√ß√£o na UTI</h2>
                    <div class="form-group">
                        <label for="motivoInternacao">Motivo da Interna√ß√£o na UTI</label>
                        <textarea id="motivoInternacao" name="motivoInternacao" placeholder="Descreva o motivo principal da interna√ß√£o..."></textarea>
                    </div>
                </div>

                <!-- 3. Diretivas de Cuidado -->
                <div class="section">
                    <h2 class="section-title">Diretivas de Cuidado</h2>
                    <div class="form-group">
                        <label>Tipo de Diretiva</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="fullCode" name="tipoDiretiva" value="full_code">
                                <label for="fullCode">Full code</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="proporcionalidade" name="tipoDiretiva" value="proporcionalidade">
                                <label for="proporcionalidade">Proporcionalidade acordada em confer√™ncia familiar</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="paliativo" name="tipoDiretiva" value="paliativo">
                                <label for="paliativo">Paliativo exclusivo acordada em confer√™ncia familiar</label>
                            </div>
                        </div>
                    </div>

                    <div id="conferenciaFields" class="conditional-field">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="dataConferencia">Data da Confer√™ncia Familiar</label>
                                <input type="date" id="dataConferencia" name="dataConferencia">
                            </div>
                            <div class="form-col">
                                <label for="participantesConferencia">Participantes da Confer√™ncia</label>
                                <input type="text" id="participantesConferencia" name="participantesConferencia" placeholder="Nome dos participantes...">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4. Hist√≥rico da Doen√ßa Atual -->
                <div class="section">
                    <h2 class="section-title">Hist√≥rico da Doen√ßa Atual</h2>
                    <div class="form-group">
                        <label for="historiaDoenca">Hist√≥ria da Doen√ßa Atual</label>
                        <textarea id="historiaDoenca" name="historiaDoenca" placeholder="Descreva a evolu√ß√£o da doen√ßa atual..."></textarea>
                    </div>
                </div>

                <!-- 5. Antecedentes -->
                <div class="section">
                    <h2 class="section-title">Antecedentes</h2>
                    <div class="form-group">
                        <label>Comorbidades</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="has" name="comorbidades[]" value="has">
                                <label for="has">HAS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dm" name="comorbidades[]" value="dm">
                                <label for="dm">DM</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="icc" name="comorbidades[]" value="icc">
                                <label for="icc">ICC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="cancer" name="comorbidades[]" value="cancer">
                                <label for="cancer">C√¢ncer</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="iam" name="comorbidades[]" value="iam">
                                <label for="iam">IAM pr√©vio</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="avc" name="comorbidades[]" value="avc">
                                <label for="avc">AVC pr√©vio</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="alzheimer" name="comorbidades[]" value="alzheimer">
                                <label for="alzheimer">Alzheimer</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="parkinson" name="comorbidades[]" value="parkinson">
                                <label for="parkinson">Parkinson</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dpoc" name="comorbidades[]" value="dpoc">
                                <label for="dpoc">DPOC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="irc" name="comorbidades[]" value="irc">
                                <label for="irc">IRC</label>
                            </div>
                        </div>
                        <textarea name="outrasComorbidades" placeholder="Outras comorbidades..." style="margin-top: 10px;"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Tabagismo/Etilismo</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="tabagismo" name="tabagismoEtilismo[]" value="tabagismo">
                                <label for="tabagismo">Tabagismo</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="etilismo" name="tabagismoEtilismo[]" value="etilismo">
                                <label for="etilismo">Etilismo</label>
                            </div>
                        </div>
                        <input type="text" name="detalhesTabagismoEtilismo" placeholder="Detalhes (tempo, quantidade, etc.)" style="margin-top: 10px;">
                    </div>

                    <div class="form-group">
                        <label>Hist√≥rico Familiar</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="hasFamily" name="historicoFamiliar[]" value="has">
                                <label for="hasFamily">HAS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dmFamily" name="historicoFamiliar[]" value="dm">
                                <label for="dmFamily">DM</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="cancerFamily" name="historicoFamiliar[]" value="cancer">
                                <label for="cancerFamily">C√¢ncer</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="iamFamily" name="historicoFamiliar[]" value="iam">
                                <label for="iamFamily">IAM</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="avcFamily" name="historicoFamiliar[]" value="avc">
                                <label for="avcFamily">AVC</label>
                            </div>
                        </div>
                        <textarea name="outroHistoricoFamiliar" placeholder="Outros antecedentes familiares..." style="margin-top: 10px;"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Alergias</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="alergiasSim" name="temAlergias" value="sim">
                                <label for="alergiasSim">Sim</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="alergiasNao" name="temAlergias" value="nao">
                                <label for="alergiasNao">N√£o</label>
                            </div>
                        </div>
                        <div id="alergiasFields" class="conditional-field">
                            <textarea name="detalhesAlergias" placeholder="Descreva as alergias conhecidas..."></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Medicamentos de Uso Cont√≠nuo</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="captopril" name="medicamentosUso[]" value="captopril">
                                <label for="captopril">Captopril</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="losartana" name="medicamentosUso[]" value="losartana">
                                <label for="losartana">Losartana</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="enalapril" name="medicamentosUso[]" value="enalapril">
                                <label for="enalapril">Enalapril</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="metformina" name="medicamentosUso[]" value="metformina">
                                <label for="metformina">Metformina</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="glibenclamida" name="medicamentosUso[]" value="glibenclamida">
                                <label for="glibenclamida">Glibenclamida</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="sinvastatina" name="medicamentosUso[]" value="sinvastatina">
                                <label for="sinvastatina">Sinvastatina</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="aas" name="medicamentosUso[]" value="aas">
                                <label for="aas">AAS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="furosemida" name="medicamentosUso[]" value="furosemida">
                                <label for="furosemida">Furosemida</label>
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="doseMedicamento">Dose</label>
                                    <input type="text" id="doseMedicamento" name="doseMedicamento" placeholder="Ex: 25mg, 500mg...">
                                </div>
                                <div class="form-col">
                                    <label for="frequenciaMedicamento">Frequ√™ncia</label>
                                    <select id="frequenciaMedicamento" name="frequenciaMedicamento">
                                        <option value="">Selecione...</option>
                                        <option value="1x_dia">1x ao dia</option>
                                        <option value="12_12h">De 12/12h</option>
                                        <option value="8_8h">De 8/8h</option>
                                        <option value="6_6h">De 6/6h</option>
                                        <option value="sos">S.O.S</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <textarea name="outrosMedicamentos" placeholder="Outros medicamentos..." style="margin-top: 10px;"></textarea>
                    </div>
                </div>

                <!-- 6. Problemas Ativos -->
                <div class="section">
                    <h2 class="section-title">Problemas Ativos</h2>
                    <div class="form-group">
                        <label>Problemas Ativos</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="iraAguda" name="problemasAtivos[]" value="ira_aguda">
                                <label for="iraAguda">Insufici√™ncia Renal Aguda</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="sepse" name="problemasAtivos[]" value="sepse">
                                <label for="sepse">Sepse</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="choqueSeptico" name="problemasAtivos[]" value="choque_septico">
                                <label for="choqueSeptico">Choque S√©ptico</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="sdra" name="problemasAtivos[]" value="sdra">
                                <label for="sdra">SDRA</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="iraResp" name="problemasAtivos[]" value="ira_resp">
                                <label for="iraResp">Insufici√™ncia Respirat√≥ria Aguda</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="choqueCardiogenico" name="problemasAtivos[]" value="choque_cardiogenico">
                                <label for="choqueCardiogenico">Choque Cardiog√™nico</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="tce" name="problemasAtivos[]" value="tce">
                                <label for="tce">TCE</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="hemorragiaDigestiva" name="problemasAtivos[]" value="hemorragia_digestiva">
                                <label for="hemorragiaDigestiva">Hemorragia Digestiva</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="parada" name="problemasAtivos[]" value="parada_cardio">
                                <label for="parada">Parada Cardiorrespirat√≥ria</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="pneumonia" name="problemasAtivos[]" value="pneumonia">
                                <label for="pneumonia">Pneumonia</label>
                            </div>
                        </div>
                        <textarea name="outrosProblemas" placeholder="Outros problemas ativos..." style="margin-top: 10px;"></textarea>
                    </div>
                </div>

                <!-- 7. Evolu√ß√£o do Dia -->
                <div class="section">
                    <h2 class="section-title">Evolu√ß√£o do Dia</h2>
                    <div class="form-group">
                        <label for="evolucaoDia">Evolu√ß√£o do Dia</label>
                        <textarea id="evolucaoDia" name="evolucaoDia" placeholder="Registro da evolu√ß√£o di√°ria do paciente..."></textarea>
                    </div>
                </div>

                <!-- 8. Neurol√≥gico -->
                <div class="section">
                    <h2 class="section-title">Avalia√ß√£o Neurol√≥gica</h2>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="pupilas">Pupilas</label>
                            <select id="pupilas" name="pupilas">
                                <option value="">Selecione...</option>
                                <option value="isocoricas_fotoreagentes">Isoc√≥ricas e fotorreagentes</option>
                                <option value="anisocoricas">Anisoc√≥ricas</option>
                                <option value="midriase_bilateral">Midr√≠ase bilateral</option>
                                <option value="miose_bilateral">Miose bilateral</option>
                                <option value="arreagentes">Arreagentes</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label for="rass">RASS</label>
                            <select id="rass" name="rass">
                                <option value="">Selecione...</option>
                                <option value="+4">+4 - Combativo</option>
                                <option value="+3">+3 - Muito agitado</option>
                                <option value="+2">+2 - Agitado</option>
                                <option value="+1">+1 - Inquieto</option>
                                <option value="0">0 - Alerta e calmo</option>
                                <option value="-1">-1 - Sonolento</option>
                                <option value="-2">-2 - Seda√ß√£o leve</option>
                                <option value="-3">-3 - Seda√ß√£o moderada</option>
                                <option value="-4">-4 - Seda√ß√£o profunda</option>
                                <option value="-5">-5 - N√£o desperta</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col-small">
                            <label for="glasgowOcular">Glasgow Ocular</label>
                            <select id="glasgowOcular" name="glasgowOcular">
                                <option value="">-</option>
                                <option value="4">4</option>
                                <option value="3">3</option>
                                <option value="2">2</option>
                                <option value="1">1</option>
                            </select>
                        </div>
                        <div class="form-col-small">
                            <label for="glasgowVerbal">Glasgow Verbal</label>
                            <select id="glasgowVerbal" name="glasgowVerbal">
                                <option value="">-</option>
                                <option value="5">5</option>
                                <option value="4">4</option>
                                <option value="3">3</option>
                                <option value="2">2</option>
                                <option value="1">1</option>
                            </select>
                        </div>
                        <div class="form-col-small">
                            <label for="glasgowMotor">Glasgow Motor</label>
                            <select id="glasgowMotor" name="glasgowMotor">
                                <option value="">-</option>
                                <option value="6">6</option>
                                <option value="5">5</option>
                                <option value="4">4</option>
                                <option value="3">3</option>
                                <option value="2">2</option>
                                <option value="1">1</option>
                            </select>
                        </div>
                        <div class="form-col-small">
                            <label for="glasgowTotal">Glasgow Total</label>
                            <input type="number" id="glasgowTotal" name="glasgowTotal" readonly style="background: #f0f0f0;">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Sedativos</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="precedex" name="sedativos[]" value="precedex">
                                <label for="precedex">Precedex</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="propofol" name="sedativos[]" value="propofol">
                                <label for="propofol">Propofol</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="midazolam" name="sedativos[]" value="midazolam">
                                <label for="midazolam">Midazolam</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ketamina" name="sedativos[]" value="ketamina">
                                <label for="ketamina">Ketamina</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="haloperidol" name="sedativos[]" value="haloperidol">
                                <label for="haloperidol">Haloperidol</label>
                            </div>
                        </div>
                        <input type="text" name="outrosSedativos" placeholder="Outros sedativos..." style="margin-top: 10px;">
                    </div>

                    <div class="form-group">
                        <label>Analgesia</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="fentanil" name="analgesia[]" value="fentanil">
                                <label for="fentanil">Fentanil</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="morfina" name="analgesia[]" value="morfina">
                                <label for="morfina">Morfina</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dipirona" name="analgesia[]" value="dipirona">
                                <label for="dipirona">Dipirona</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="tramadol" name="analgesia[]" value="tramadol">
                                <label for="tramadol">Tramadol</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="paracetamol" name="analgesia[]" value="paracetamol">
                                <label for="paracetamol">Paracetamol</label>
                            </div>
                        </div>
                        <input type="text" name="outrasAnalgesicas" placeholder="Outras analgesias..." style="margin-top: 10px;">
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label for="alteracoesNeuro">Altera√ß√µes ou D√©ficits Neurol√≥gicos</label>
                            <textarea id="alteracoesNeuro" name="alteracoesNeuro" placeholder="Descreva altera√ß√µes neurol√≥gicas..."></textarea>
                        </div>
                        <div class="form-col">
                            <label>Delirium</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="deliriumHipo" name="delirium" value="hipoativo">
                                    <label for="deliriumHipo">Hipoativo</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="deliriumHiper" name="delirium" value="hiperativo">
                                    <label for="deliriumHiper">Hiperativo</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="deliriumNao" name="delirium" value="nao">
                                    <label for="deliriumNao">N√£o</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 9. Hemodin√¢mica / Cardiovascular -->
                <div class="section">
                    <h2 class="section-title">Hemodin√¢mica / Cardiovascular</h2>
                    <div class="form-group">
                        <label>Vasopressores/Inotr√≥picos</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="noradrenalina" name="vasopressores[]" value="noradrenalina">
                                <label for="noradrenalina">Noradrenalina</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="adrenalina" name="vasopressores[]" value="adrenalina">
                                <label for="adrenalina">Adrenalina</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="vasopressina" name="vasopressores[]" value="vasopressina">
                                <label for="vasopressina">Vasopressina</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dobutamina" name="vasopressores[]" value="dobutamina">
                                <label for="dobutamina">Dobutamina</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dopamina" name="vasopressores[]" value="dopamina">
                                <label for="dopamina">Dopamina</label>
                            </div>
                        </div>
                        <div class="form-row" style="margin-top: 10px;">
                            <div class="form-col">
                                <label for="doseVasoNoradrenalina">Noradrenalina (mcg/kg/min)</label>
                                <input type="number" id="doseVasoNoradrenalina" name="doseVasoNoradrenalina" step="0.01">
                            </div>
                            <div class="form-col">
                                <label for="doseVasoDobutamina">Dobutamina (mcg/kg/min)</label>
                                <input type="number" id="doseVasoDobutamina" name="doseVasoDobutamina" step="0.1">
                            </div>
                            <div class="form-col">
                                <label for="doseVasoVasopressina">Vasopressina (UI/h)</label>
                                <input type="number" id="doseVasoVasopressina" name="doseVasoVasopressina" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label>Hemodinamicamente</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="hemoEstavel" name="hemodinamica" value="estavel">
                                    <label for="hemoEstavel">Est√°vel</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="hemoInstavel" name="hemodinamica" value="instavel">
                                    <label for="hemoInstavel">Inst√°vel</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-col">
                            <label>Perfus√£o perif√©rica</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="perfusaoBoa" name="perfusao" value="boa">
                                    <label for="perfusaoBoa">Boa</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="perfusaoRuim" name="perfusao" value="ruim">
                                    <label for="perfusaoRuim">Ruim</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col-small">
                            <label for="pasSistolica">PA Sist√≥lica</label>
                            <input type="number" id="pasSistolica" name="pasSistolica" min="0" max="300">
                        </div>
                        <div class="form-col-small">
                            <label for="pasDiastolica">PA Diast√≥lica</label>
                            <input type="number" id="pasDiastolica" name="pasDiastolica" min="0" max="200">
                        </div>
                        <div class="form-col-small">
                            <label for="pamCalculada">PAM (calc.)</label>
                            <input type="number" id="pamCalculada" name="pamCalculada" readonly style="background: #f0f0f0;">
                        </div>
                        <div class="form-col">
                            <label for="ritmoCardiaco">Ritmo Card√≠aco</label>
                            <select id="ritmoCardiaco" name="ritmoCardiaco">
                                <option value="">Selecione...</option>
                                <option value="regular">Ritmo card√≠aco regular</option>
                                <option value="irregular">Ritmo card√≠aco irregular</option>
                            </select>
                        </div>
                        <div class="form-col-small">
                            <label for="fc">FC (bpm)</label>
                            <input type="number" id="fc" name="fc" min="0" max="300">
                        </div>
                        <div class="form-col-small">
                            <label for="lactato">Lactato</label>
                            <input type="number" id="lactato" name="lactato" step="0.1">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Vasodilatadores/Anti-hipertensivos</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="nitroglicerina" name="vasodilatadores[]" value="nitroglicerina">
                                <label for="nitroglicerina">Nitroglicerina</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="nitroprussiato" name="vasodilatadores[]" value="nitroprussiato">
                                <label for="nitroprussiato">Nitroprussiato</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="clevidipina" name="vasodilatadores[]" value="clevidipina">
                                <label for="clevidipina">Clevidipina</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="metoprolol" name="vasodilatadores[]" value="metoprolol">
                                <label for="metoprolol">Metoprolol</label>
                            </div>
                        </div>
                        <textarea name="outrosVasodilatadores" placeholder="Outros vasodilatadores..." style="margin-top: 10px;"></textarea>
                    </div>
                </div>

                <!-- 10. Respirat√≥rio -->
                <div class="section">
                    <h2 class="section-title">Sistema Respirat√≥rio</h2>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Padr√£o Respirat√≥rio</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="eupneico" name="padraoResp" value="eupneico">
                                    <label for="eupneico">Eupneico</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="dispneico" name="padraoResp" value="dispneico">
                                    <label for="dispneico">Dispneico</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-col">
                            <label for="suporteResp">Suporte Respirat√≥rio</label>
                            <select id="suporteResp" name="suporteResp">
                                <option value="">Selecione...</option>
                                <option value="ar_ambiente">Ar ambiente</option>
                                <option value="cateter_o2">Cateter de O2</option>
                                <option value="mascara_o2">M√°scara O2</option>
                                <option value="vni">VNI</option>
                                <option value="vm_iot">VM + IOT</option>
                            </select>
                        </div>
                    </div>

                    <div id="cateterFields" class="conditional-field">
                        <div class="form-col-small">
                            <label for="fluxoO2Cateter">Fluxo O2 (L/min)</label>
                            <input type="number" id="fluxoO2Cateter" name="fluxoO2Cateter" min="1" max="15">
                        </div>
                    </div>

                    <div id="mascaraFields" class="conditional-field">
                        <div class="form-col-small">
                            <label for="fluxoO2Mascara">Fluxo O2 (L/min)</label>
                            <input type="number" id="fluxoO2Mascara" name="fluxoO2Mascara" min="1" max="15">
                        </div>
                    </div>

                    <div id="vmFields" class="conditional-field">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="dataVm">Data VM</label>
                                <input type="date" id="dataVm" name="dataVm">
                            </div>
                            <div class="form-col">
                                <label for="vmModo">Modo VM</label>
                                <select id="vmModo" name="vmModo">
                                    <option value="">Selecione...</option>
                                    <option value="pcv">PCV</option>
                                    <option value="psv">PSV</option>
                                    <option value="vcv">VCV</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-col-small">
                                <label for="peep">PEEP</label>
                                <input type="number" id="peep" name="peep" step="1">
                            </div>
                            <div class="form-col-small">
                                <label for="fio2">FIO2</label>
                                <input type="number" id="fio2" name="fio2" step="5" min="21" max="100">
                            </div>
                            <div class="form-col-small">
                                <label for="tins">TINS</label>
                                <input type="number" id="tins" name="tins" step="0.1">
                            </div>
                            <div class="form-col-small">
                                <label for="fr">FR</label>
                                <input type="number" id="fr" name="fr" min="8" max="35">
                            </div>
                        </div>

                        <div id="psvFields" class="conditional-field">
                            <div class="form-col-small">
                                <label for="p01">p0.1</label>
                                <input type="number" id="p01" name="p01" step="0.1">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Desmame VM</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="desmameSim" name="desmeVm" value="sim">
                                    <label for="desmameSim">Sim</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="desmeNao" name="desmeVm" value="nao">
                                    <label for="desmeNao">N√£o</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Secre√ß√£o traqueal</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="temSecrecaoSim" name="temSecrecao" value="sim">
                                <label for="temSecrecaoSim">Sim</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="temSecrecaoNao" name="temSecrecao" value="nao">
                                <label for="temSecrecaoNao">N√£o</label>
                            </div>
                        </div>
                        <div id="secrecaoFields" class="conditional-field">
                            <textarea name="caracteristicasSecrecao" placeholder="Descreva caracter√≠sticas da secre√ß√£o..."></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col-small">
                            <label for="ph">pH</label>
                            <input type="number" id="ph" name="ph" step="0.01" min="6" max="8">
                        </div>
                        <div class="form-col-small">
                            <label for="po2">pO2</label>
                            <input type="number" id="po2" name="po2" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="pco2">pCO2</label>
                            <input type="number" id="pco2" name="pco2" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="hco3">HCO3</label>
                            <input type="number" id="hco3" name="hco3" step="0.1">
                        </div>
                        <div class="form-col-small">
                            <label for="relacaoPoFio">pO2/FiO2 (calc.)</label>
                            <input type="number" id="relacaoPoFio" name="relacaoPoFio" readonly style="background: #f0f0f0;">
                        </div>
                    </div>
                </div>

                <!-- 11. Trato Gastrointestinal -->
                <div class="section">
                    <h2 class="section-title">Trato Gastrointestinal</h2>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="tipoDiseta">Tipo de Dieta</label>
                            <select id="tipoDiseta" name="tipoDiseta">
                                <option value="">Selecione...</option>
                                <option value="oral">Oral</option>
                                <option value="enteral">Enteral</option>
                                <option value="parenteral">Parenteral</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label for="recebendo">Recebendo</label>
                            <input type="text" id="recebendo" name="recebendo" placeholder="Descreva o que est√° recebendo...">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="metaNutricional">Meta Nutricional</label>
                        <textarea id="metaNutricional" name="metaNutricional" placeholder="Descreva a meta nutricional..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Evacua√ß√£o</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="evacuacaoSim" name="evacuacao" value="sim">
                                <label for="evacuacaoSim">Sim</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="evacuacaoNao" name="evacuacao" value="nao">
                                <label for="evacuacaoNao">N√£o</label>
                            </div>
                        </div>
                        <div id="evacuacaoFields" class="conditional-field">
                            <label for="dataUltimaEvacuacao">Data da √∫ltima evacua√ß√£o</label>
                            <input type="date" id="dataUltimaEvacuacao" name="dataUltimaEvacuacao">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Medidas Anti-constipantes</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="bisacodil" name="antiConstipantes[]" value="bisacodil">
                                <label for="bisacodil">Bisacodil</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="lactulose" name="antiConstipantes[]" value="lactulose">
                                <label for="lactulose">Lactulose</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fleetEnema" name="antiConstipantes[]" value="fleet_enema">
                                <label for="fleetEnema">Fleet Enema</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="clister" name="antiConstipantes[]" value="clister">
                                <label for="clister">Cl√≠ster</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="exameFisicoGI">Exame F√≠sico</label>
                        <textarea id="exameFisicoGI" name="exameFisicoGI">Abdome semigloboso, fl√°cido, ru√≠dos hidro a√©reos presentes, indolor √† palpa√ß√£o superficial e profunda, sem visceromegalias.</textarea>
                    </div>

                    <div class="form-group">
                        <label>Profilaxia G√°strica</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="profilaxiaGastricaSim" name="profilaxiaGastrica" value="sim">
                                <label for="profilaxiaGastricaSim">Sim</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="profilaxiaGastricaNao" name="profilaxiaGastrica" value="nao">
                                <label for="profilaxiaGastricaNao">N√£o</label>
                            </div>
                        </div>
                        <div id="profilaxiaGastricaFields" class="conditional-field">
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="omeprazolVO" name="tipoProfilaxiaGastrica[]" value="omeprazol_vo">
                                    <label for="omeprazolVO">Omeprazol VO</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="omeprazolIV" name="tipoProfilaxiaGastrica[]" value="omeprazol_iv">
                                    <label for="omeprazolIV">Omeprazol IV</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 12. Renal -->
                <div class="section">
                    <h2 class="section-title">Sistema Renal</h2>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="diurese24h">Diurese √∫ltimas 24h (ml)</label>
                            <input type="number" id="diurese24h" name="diurese24h" min="0">
                        </div>
                        <div class="form-col">
                            <label for="balancoHidrico">Balan√ßo h√≠drico √∫ltimas 24h</label>
                            <input type="number" id="balancoHidrico" name="balancoHidrico">
                        </div>
                        <div class="form-col-small">
                            <label for="peso">Peso (kg)</label>
                            <input type="number" id="peso" name="peso" min="30" max="200" step="0.1">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Di√°lise</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="dialiseSim" name="dialise" value="sim">
                                <label for="dialiseSim">Sim</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="dialiseNao" name="dialise" value="nao">
                                <label for="dialiseNao">N√£o</label>
                            </div>
                        </div>
                    </div>

                    <div id="dialiseFields" class="conditional-field">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="dataUltimaSessao">Data da √∫ltima sess√£o</label>
                                <input type="date" id="dataUltimaSessao" name="dataUltimaSessao">
                            </div>
                            <div class="form-col">
                                <label for="uf">UF</label>
                                <input type="text" id="uf" name="uf" placeholder="Ultrafiltra√ß√£o...">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col-small">
                            <label for="cr">Creatinina</label>
                            <input type="number" id="cr" name="cr" step="0.01">
                        </div>
                        <div class="form-col-small">
                            <label for="ur">Ureia</label>
                            <input type="number" id="ur" name="ur" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="na">S√≥dio (Na)</label>
                            <input type="number" id="na" name="na" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="k">Pot√°ssio (K)</label>
                            <input type="number" id="k" name="k" step="0.1">
                        </div>
                        <div class="form-col-small">
                            <label for="ca">C√°lcio (Ca)</label>
                            <input type="number" id="ca" name="ca" step="0.01">
                        </div>
                        <div class="form-col-small">
                            <label for="fosforo">F√≥sforo</label>
                            <input type="number" id="fosforo" name="fosforo" step="0.1">
                        </div>
                        <div class="form-col-small">
                            <label for="magnesio">Magn√©sio</label>
                            <input type="number" id="magnesio" name="magnesio" step="0.01">
                        </div>
                        <div class="form-col-small">
                            <label for="cloro">Cloro</label>
                            <input type="number" id="cloro" name="cloro" step="1">
                        </div>
                    </div>
                </div>

                <!-- 13. Metab√≥lico -->
                <div class="section">
                    <h2 class="section-title">Sistema Metab√≥lico</h2>
                    <div class="form-row">
                        <div class="form-col-small">
                            <label for="glicemiaJejum">Jejum</label>
                            <input type="number" id="glicemiaJejum" name="glicemiaJejum" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="glicemiaPrePrandial">Pr√©-prandial</label>
                            <input type="number" id="glicemiaPrePrandial" name="glicemiaPrePrandial" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="glicemiaPosPrandial">P√≥s-prandial</label>
                            <input type="number" id="glicemiaPosPrandial" name="glicemiaPosPrandial" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="glicemiaAntesDormir">Antes dormir</label>
                            <input type="number" id="glicemiaAntesDormir" name="glicemiaAntesDormir" step="1">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label for="insulinaNPH">Insulina NPH (UI - hor√°rio)</label>
                            <input type="text" id="insulinaNPH" name="insulinaNPH" placeholder="Ex: 10UI - 8h, 8UI - 20h">
                        </div>
                        <div class="form-col">
                            <label for="insulinaRegular">Insulina Regular (UI - hor√°rio)</label>
                            <input type="text" id="insulinaRegular" name="insulinaRegular" placeholder="Ex: 4UI - conforme HGT">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label>Endocrinopatia pr√©via?</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="endocrinoSim" name="endocrinopatia" value="sim">
                                    <label for="endocrinoSim">Sim</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="endocrinoNao" name="endocrinopatia" value="nao">
                                    <label for="endocrinoNao">N√£o</label>
                                </div>
                            </div>
                            <div id="endocrinoDetails" class="conditional-field">
                                <input type="text" name="detalhesEndocrino" placeholder="Detalhes da endocrinopatia...">
                            </div>
                        </div>
                        <div class="form-col">
                            <label>Uso de cortic√≥ide?</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="corticoideSim" name="corticoide" value="sim">
                                    <label for="corticoideSim">Sim</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="corticoideNao" name="corticoide" value="nao">
                                    <label for="corticoideNao">N√£o</label>
                                </div>
                            </div>
                            <div id="corticoideDetails" class="conditional-field">
                                <input type="text" name="detalhesCorticoide" placeholder="Detalhes do cortic√≥ide...">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 14. Hematol√≥gico -->
                <div class="section">
                    <h2 class="section-title">Sistema Hematol√≥gico</h2>
                    <div class="form-group">
                        <label>Profilaxia TEV</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="profilaxiaTevSim" name="profilaxiaTev" value="sim">
                                <label for="profilaxiaTevSim">Sim</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="profilaxiaTevNao" name="profilaxiaTev" value="nao">
                                <label for="profilaxiaTevNao">N√£o</label>
                            </div>
                        </div>
                        <div id="profilaxiaTevFields" class="conditional-field">
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="enoxaparina40" name="tipoProfilaxiaTev[]" value="enoxaparina_40">
                                    <label for="enoxaparina40">Enoxaparina 40mg 1x ao dia</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="enoxaparina60" name="tipoProfilaxiaTev[]" value="enoxaparina_60">
                                    <label for="enoxaparina60">Enoxaparina 60mg 1x ao dia</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hnf12h" name="tipoProfilaxiaTev[]" value="hnf_12h">
                                    <label for="hnf12h">HNF 5.000UI de 12/12h</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hnf8h" name="tipoProfilaxiaTev[]" value="hnf_8h">
                                    <label for="hnf8h">HNF 5.000UI de 8/8h</label>
                                </div>
                            </div>
                        </div>
                        <div id="contraindicacaoTevFields" class="conditional-field">
                            <textarea name="contraindicacaoTev" placeholder="Contraindica√ß√µes para profilaxia TEV..."></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Houve sangramento?</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="sangramentoSim" name="sangramento" value="sim">
                                <label for="sangramentoSim">Sim</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="sangramentoNao" name="sangramento" value="nao">
                                <label for="sangramentoNao">N√£o</label>
                            </div>
                        </div>
                        <div id="sangramentoDetails" class="conditional-field">
                            <textarea name="detalhesSangramento" placeholder="Detalhes do sangramento..."></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Transfus√µes</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="transfusoesSim" name="transfusoes" value="sim">
                                <label for="transfusoesSim">Sim</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="transfusoesNao" name="transfusoes" value="nao">
                                <label for="transfusoesNao">N√£o</label>
                            </div>
                        </div>
                        <div id="transfusoesFields" class="conditional-field">
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hemacias" name="tipoTransfusao[]" value="hemacias">
                                    <label for="hemacias">Hem√°cias</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="plasma" name="tipoTransfusao[]" value="plasma">
                                    <label for="plasma">Plasma</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="plaquetas" name="tipoTransfusao[]" value="plaquetas">
                                    <label for="plaquetas">Plaquetas</label>
                                </div>
                            </div>
                            <textarea name="detalhesTransfusao" placeholder="Detalhes das transfus√µes..." style="margin-top: 10px;"></textarea>
                        </div>
                    </div>

                    <div class="form-col-small">
                        <label for="hemoglobina">Hemoglobina</label>
                        <input type="number" id="hemoglobina" name="hemoglobina" step="0.1">
                    </div>
                </div>

                <!-- 15. Infeccioso -->
                <div class="section">
                    <h2 class="section-title">Sistema Infeccioso</h2>
                    <div class="form-row">
                        <div class="form-col">
                            <label>Febril?</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="febrilSim" name="febril" value="sim">
                                    <label for="febrilSim">Sim</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="febrilNao" name="febril" value="nao">
                                    <label for="febrilNao">N√£o</label>
                                </div>
                            </div>
                            <div id="febrilFields" class="conditional-field">
                                <label for="temperatura">Temperatura (¬∞C)</label>
                                <input type="number" id="temperatura" name="temperatura" step="0.1" min="35" max="45">
                            </div>
                        </div>
                        <div class="form-col">
                            <label>Nova disfun√ß√£o sugestiva de Sepse?</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="sepseSim" name="sepse" value="sim">
                                    <label for="sepseSim">Sim</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="sepseNao" name="sepse" value="nao">
                                    <label for="sepseNao">N√£o</label>
                                </div>
                            </div>
                            <div id="sepseDetails" class="conditional-field">
                                <textarea name="detalhesSepse" placeholder="Detalhes da disfun√ß√£o..."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col-small">
                            <label for="leuco">Leuc√≥citos</label>
                            <input type="number" id="leuco" name="leuco" step="100">
                        </div>
                        <div class="form-col-small">
                            <label for="neutro">Neutr√≥filos (%)</label>
                            <input type="number" id="neutro" name="neutro" step="1" min="0" max="100">
                        </div>
                        <div class="form-col-small">
                            <label for="pcr">PCR</label>
                            <input type="number" id="pcr" name="pcr" step="0.1">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Antibi√≥ticos em uso</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="ceftriaxone" name="antibioticos[]" value="ceftriaxone">
                                <label for="ceftriaxone">Ceftriaxone</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="tazocin" name="antibioticos[]" value="tazocin">
                                <label for="tazocin">Tazocin</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="meropenem" name="antibioticos[]" value="meropenem">
                                <label for="meropenem">Meropenem</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="vancomicina" name="antibioticos[]" value="vancomicina">
                                <label for="vancomicina">Vancomicina</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="teicoplanina" name="antibioticos[]" value="teicoplanina">
                                <label for="teicoplanina">Teicoplanina</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="linezolida" name="antibioticos[]" value="linezolida">
                                <label for="linezolida">Linezolida</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="polimixina" name="antibioticos[]" value="polimixina">
                                <label for="polimixina">Polimixina B</label>
                            </div>
                        </div>
                        <div class="form-row" style="margin-top: 10px;">
                            <div class="form-col">
                                <label for="dataInicioAtb">Data de in√≠cio</label>
                                <input type="date" id="dataInicioAtb" name="dataInicioAtb">
                            </div>
                            <div class="form-col">
                                <label for="dataFimAtb">Data de fim</label>
                                <input type="date" id="dataFimAtb" name="dataFimAtb">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="intervencaoFoco">Interven√ß√£o relacionada a foco infeccioso</label>
                        <textarea id="intervencaoFoco" name="intervencaoFoco" placeholder="Descreva interven√ß√µes..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="atbPrevios">ATBs pr√©vios nesta interna√ß√£o</label>
                        <textarea id="atbPrevios" name="atbPrevios" placeholder="Antibi√≥ticos usados anteriormente..."></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label>Hemocultura</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="hemoculturaSim" name="hemocultura" value="sim">
                                    <label for="hemoculturaSim">Sim</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="hemoculturaNao" name="hemocultura" value="nao">
                                    <label for="hemoculturaNao">N√£o</label>
                                </div>
                            </div>
                            <div id="hemoculturaFields" class="conditional-field">
                                <label for="dataHemocultura">Data da coleta</label>
                                <input type="date" id="dataHemocultura" name="dataHemocultura">
                                <textarea name="resultadoHemocultura" placeholder="Resultado ou pendente..." style="margin-top: 10px;"></textarea>
                            </div>
                        </div>
                        <div class="form-col">
                            <label>Urocultura</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="uroculturaSim" name="urocultura" value="sim">
                                    <label for="uroculturaSim">Sim</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="uroculturaNao" name="urocultura" value="nao">
                                    <label for="uroculturaNao">N√£o</label>
                                </div>
                            </div>
                            <div id="uroculturaFields" class="conditional-field">
                                <label for="dataUrocultura">Data da coleta</label>
                                <input type="date" id="dataUrocultura" name="dataUrocultura">
                                <textarea name="resultadoUrocultura" placeholder="Resultado ou pendente..." style="margin-top: 10px;"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 16. Pele/Mucosa/Osteomuscular -->
                <div class="section">
                    <h2 class="section-title">Pele/Mucosa/Osteomuscular</h2>
                    <div class="form-group">
                        <label>Les√µes por press√£o?</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="lesoesSim" name="lesoesPressao" value="sim">
                                <label for="lesoesSim">Sim</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="lesoesNao" name="lesoesPressao" value="nao">
                                <label for="lesoesNao">N√£o</label>
                            </div>
                        </div>
                        <div id="lesoesDetails" class="conditional-field">
                            <textarea name="detalhesLesoes" placeholder="Localiza√ß√£o e grau das les√µes..."></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label>Profilaxia Ocular</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="profilaxiaOcularSim" name="profilaxiaOcular" value="sim">
                                    <label for="profilaxiaOcularSim">Sim</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="profilaxiaOcularNao" name="profilaxiaOcular" value="nao">
                                    <label for="profilaxiaOcularNao">N√£o</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-col">
                            <label>Higiene Oral</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="higieneOralSim" name="higieneOral" value="sim">
                                    <label for="higieneOralSim">Sim</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="higieneOralNao" name="higieneOral" value="nao">
                                    <label for="higieneOralNao">N√£o</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 17. Dispositivos -->
                <div class="section">
                    <h2 class="section-title">Dispositivos</h2>
                    <div class="form-group">
                        <label>Acesso Venoso</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="acessoPeriferico" name="acessoVenoso[]" value="periferico">
                                <label for="acessoPeriferico">Perif√©rico</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="acessoCentral" name="acessoVenoso[]" value="central">
                                <label for="acessoCentral">Central</label>
                            </div>
                        </div>
                    </div>

                    <div id="acessoPerifericoFields" class="conditional-field">
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="msEsquerdo" name="localPeriferico[]" value="mse">
                                <label for="msEsquerdo">Membro superior esquerdo</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="msDireito" name="localPeriferico[]" value="msd">
                                <label for="msDireito">Membro superior direito</label>
                            </div>
                        </div>
                    </div>

                    <div id="acessoCentralFields" class="conditional-field">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="dataAcessoCentral">Data Acesso Central</label>
                                <input type="date" id="dataAcessoCentral" name="dataAcessoCentral">
                            </div>
                            <div class="form-col">
                                <label for="localAcessoCentral">Local Acesso Central</label>
                                <select id="localAcessoCentral" name="localAcessoCentral">
                                    <option value="">Selecione...</option>
                                    <option value="jugular_direita">Jugular direita</option>
                                    <option value="jugular_esquerda">Jugular esquerda</option>
                                    <option value="subclavia_direita">Subcl√°via direita</option>
                                    <option value="subclavia_esquerda">Subcl√°via esquerda</option>
                                    <option value="femoral_direita">Femoral direita</option>
                                    <option value="femoral_esquerda">Femoral esquerda</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Shilley</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="shilleySim" name="shilley" value="sim">
                                <label for="shilleySim">Sim</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="shilleyNao" name="shilley" value="nao">
                                <label for="shilleyNao">N√£o</label>
                            </div>
                        </div>
                    </div>

                    <div id="shilleyFields" class="conditional-field">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="dataShilley">Data Shilley</label>
                                <input type="date" id="dataShilley" name="dataShilley">
                            </div>
                            <div class="form-col">
                                <label for="localShilley">Local Shilley</label>
                                <select id="localShilley" name="localShilley">
                                    <option value="">Selecione...</option>
                                    <option value="vjid">VJID</option>
                                    <option value="vjie">VJIE</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>PA Invasiva</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="paInvasivaSim" name="paInvasiva" value="sim">
                                <label for="paInvasivaSim">Sim</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="paInvasivaNao" name="paInvasiva" value="nao">
                                <label for="paInvasivaNao">N√£o</label>
                            </div>
                        </div>
                    </div>

                    <div id="paInvasivaFields" class="conditional-field">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="dataPaInvasiva">Data PA Invasiva</label>
                                <input type="date" id="dataPaInvasiva" name="dataPaInvasiva">
                            </div>
                            <div class="form-col">
                                <label for="localPaInvasiva">Local PA Invasiva</label>
                                <select id="localPaInvasiva" name="localPaInvasiva">
                                    <option value="">Selecione...</option>
                                    <option value="radial_esquerda">Art√©ria Radial Esquerda</option>
                                    <option value="radial_direita">Art√©ria Radial Direita</option>
                                    <option value="femoral_esquerda">Art√©ria Femoral Esquerda</option>
                                    <option value="femoral_direita">Art√©ria Femoral Direita</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Tubos, sondas e drenos</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="tot" name="dispositivosGerais[]" value="tot">
                                <label for="tot">Tubo orotraqueal (TOT)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="sne" name="dispositivosGerais[]" value="sne">
                                <label for="sne">Sonda nasoenteral (SNE)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="cvc" name="dispositivosGerais[]" value="cvc">
                                <label for="cvc">Cateter Venoso Central (CVC)</label>
                            </div>
                        </div>
                        <div id="totFields" class="conditional-field">
                            <label for="dataTot">Data coloca√ß√£o TOT</label>
                            <input type="date" id="dataTot" name="dataTot">
                        </div>
                        <div id="sneFields" class="conditional-field">
                            <label for="dataSne">Data coloca√ß√£o SNE</label>
                            <input type="date" id="dataSne" name="dataSne">
                        </div>
                        <textarea name="outrosDispositivos" placeholder="Outros dispositivos..." style="margin-top: 10px;"></textarea>
                    </div>
                </div>

                <!-- 18. Procedimentos nesta Interna√ß√£o -->
                <div class="section">
                    <h2 class="section-title">Procedimentos nesta Interna√ß√£o</h2>
                    <div class="form-group">
                        <label for="procedimentos">Procedimentos nesta Interna√ß√£o</label>
                        <textarea id="procedimentos" name="procedimentos" placeholder="Liste todos os procedimentos realizados durante a interna√ß√£o..."></textarea>
                    </div>
                </div>

                <!-- 19. Exames -->
                <div class="section">
                    <h2 class="section-title">Exames Laboratoriais</h2>
                    
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">Hemograma</h3>
                    <div class="form-row">
                        <div class="form-col-small">
                            <label for="examHemoglobina">Hemoglobina</label>
                            <input type="number" id="examHemoglobina" name="examHemoglobina" step="0.1">
                        </div>
                        <div class="form-col-small">
                            <label for="examHematocrito">Hemat√≥crito</label>
                            <input type="number" id="examHematocrito" name="examHematocrito" step="0.1">
                        </div>
                        <div class="form-col-small">
                            <label for="examVcm">VCM</label>
                            <input type="number" id="examVcm" name="examVcm" step="0.1">
                        </div>
                        <div class="form-col-small">
                            <label for="examLeucocitos">Leuc√≥citos</label>
                            <input type="number" id="examLeucocitos" name="examLeucocitos" step="100">
                        </div>
                        <div class="form-col-small">
                            <label for="examNeutrofilos">Neutr√≥filos (%)</label>
                            <input type="number" id="examNeutrofilos" name="examNeutrofilos" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="examLinfocitos">Linf√≥citos (%)</label>
                            <input type="number" id="examLinfocitos" name="examLinfocitos" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="examPlaquetas">Plaquetas</label>
                            <input type="number" id="examPlaquetas" name="examPlaquetas" step="1000">
                        </div>
                    </div>

                    <h3 style="color: #2c3e50; margin: 20px 0 15px 0;">Bioqu√≠mica</h3>
                    <div class="form-row">
                        <div class="form-col-small">
                            <label for="examUreia">Ureia</label>
                            <input type="number" id="examUreia" name="examUreia" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="examCreatinina">Creatinina</label>
                            <input type="number" id="examCreatinina" name="examCreatinina" step="0.01">
                        </div>
                        <div class="form-col-small">
                            <label for="examSodio">S√≥dio</label>
                            <input type="number" id="examSodio" name="examSodio" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="examPotassio">Pot√°ssio</label>
                            <input type="number" id="examPotassio" name="examPotassio" step="0.1">
                        </div>
                        <div class="form-col-small">
                            <label for="examCalcio">C√°lcio i√¥nico</label>
                            <input type="number" id="examCalcio" name="examCalcio" step="0.01">
                        </div>
                        <div class="form-col-small">
                            <label for="examMagnesio">Magn√©sio</label>
                            <input type="number" id="examMagnesio" name="examMagnesio" step="0.01">
                        </div>
                        <div class="form-col-small">
                            <label for="examFosforo">F√≥sforo</label>
                            <input type="number" id="examFosforo" name="examFosforo" step="0.1">
                        </div>
                        <div class="form-col-small">
                            <label for="examCloro">Cloro</label>
                            <input type="number" id="examCloro" name="examCloro" step="1">
                        </div>
                    </div>

                    <h3 style="color: #2c3e50; margin: 20px 0 15px 0;">Enzimas Hep√°ticas</h3>
                    <div class="form-row">
                        <div class="form-col-small">
                            <label for="examTgo">TGO</label>
                            <input type="number" id="examTgo" name="examTgo" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="examTgp">TGP</label>
                            <input type="number" id="examTgp" name="examTgp" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="examFosfatase">Fosfatase Alcalina</label>
                            <input type="number" id="examFosfatase" name="examFosfatase" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="examGamaGt">Gama GT</label>
                            <input type="number" id="examGamaGt" name="examGamaGt" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="examBilirrubina">Bilirrubina Total</label>
                            <input type="number" id="examBilirrubina" name="examBilirrubina" step="0.1">
                        </div>
                    </div>

                    <h3 style="color: #2c3e50; margin: 20px 0 15px 0;">Coagula√ß√£o e Marcadores</h3>
                    <div class="form-row">
                        <div class="form-col-small">
                            <label for="examTtpa">TTPA</label>
                            <input type="number" id="examTtpa" name="examTtpa" step="0.1">
                        </div>
                        <div class="form-col-small">
                            <label for="examInr">INR</label>
                            <input type="number" id="examInr" name="examInr" step="0.01">
                        </div>
                        <div class="form-col-small">
                            <label for="examTroponina">Troponina</label>
                            <input type="number" id="examTroponina" name="examTroponina" step="0.001">
                        </div>
                        <div class="form-col-small">
                            <label for="examCpk">CPK</label>
                            <input type="number" id="examCpk" name="examCpk" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="examNtProBnp">NT-proBNP</label>
                            <input type="number" id="examNtProBnp" name="examNtProBnp" step="1">
                        </div>
                        <div class="form-col-small">
                            <label for="examAlbumina">Albumina</label>
                            <input type="number" id="examAlbumina" name="examAlbumina" step="0.1">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="outrosExames">Outros Exames</label>
                        <textarea id="outrosExames" name="outrosExames" placeholder="Outros exames relevantes..."></textarea>
                    </div>
                </div>

                <!-- 20. Planejamento Terap√™utico Multidisciplinar -->
                <div class="section">
                    <h2 class="section-title">Planejamento Terap√™utico Multidisciplinar</h2>
                    <div class="form-group">
                        <label for="planejamento">Planejamento Terap√™utico Multidisciplinar</label>
                        <textarea id="planejamento" name="planejamento" placeholder="Descreva o planejamento terap√™utico multidisciplinar..."></textarea>
                    </div>
                </div>

                <!-- Dashboard de Evolu√ß√£o -->
                <div class="dashboard-container" id="dashboardSection" style="display: none;">
                    <div class="dashboard-header">
                        <h2>üìä Dashboard de Evolu√ß√£o do Paciente</h2>
                        <p>An√°lise gr√°fica da evolu√ß√£o cl√≠nica ao longo dos dias</p>
                    </div>

                    <div class="evolution-controls">
                        <input type="date" class="date-selector" id="dataInicio" placeholder="Data in√≠cio">
                        <input type="date" class="date-selector" id="dataFim" placeholder="Data fim">
                        <button type="button" class="chart-btn" onclick="filtrarPeriodo()">üìÖ Filtrar Per√≠odo</button>
                        <button type="button" class="chart-btn" onclick="adicionarDadosDemo()">üéØ Dados Demo</button>
                        <button type="button" class="chart-btn" onclick="salvarEvolucao()">üíæ Salvar Dia Atual</button>
                    </div>

                    <!-- Alertas de Tend√™ncia -->
                    <div class="alert-panel" id="alertPanel" style="display: none;">
                        <h3>üö® Alertas de Tend√™ncia</h3>
                        <div id="alertContent"></div>
                    </div>

                    <!-- Tabs para organizar gr√°ficos -->
                    <div class="tabs-container">
                        <button class="tab-btn active" onclick="showTab('neurological')">üß† Neurol√≥gico</button>
                        <button class="tab-btn" onclick="showTab('hemodynamic')">‚ù§Ô∏è Hemodin√¢mico</button>
                        <button class="tab-btn" onclick="showTab('respiratory')">ü´Å Respirat√≥rio</button>
                        <button class="tab-btn" onclick="showTab('metabolic')">üß™ Metab√≥lico</button>
                        <button class="tab-btn" onclick="showTab('renal')">üíß Renal</button>
                        <button class="tab-btn" onclick="showTab('nutrition')">üçΩÔ∏è Nutricional</button>
                    </div>

                    <!-- Neurol√≥gico -->
                    <div id="neurological" class="tab-content active">
                        <div class="chart-grid">
                            <div class="chart-container">
                                <div class="chart-title">N√≠vel de Consci√™ncia - RASS</div>
                                <div class="trend-indicator" id="trendRass">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartRass"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Escala de Glasgow</div>
                                <div class="trend-indicator" id="trendGlasgow">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartGlasgow"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hemodin√¢mico -->
                    <div id="hemodynamic" class="tab-content">
                        <div class="chart-grid">
                            <div class="chart-container">
                                <div class="chart-title">Press√£o Arterial M√©dia (PAM)</div>
                                <div class="trend-indicator" id="trendPAM">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartPAM"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Lactato S√©rico</div>
                                <div class="trend-indicator" id="trendLactato">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartLactato"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Dose de Noradrenalina</div>
                                <div class="trend-indicator" id="trendNoradrenalina">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartNoradrenalina"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Frequ√™ncia Card√≠aca</div>
                                <div class="trend-indicator" id="trendFC">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartFC"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Respirat√≥rio -->
                    <div id="respiratory" class="tab-content">
                        <div class="chart-grid">
                            <div class="chart-container">
                                <div class="chart-title">Rela√ß√£o pO2/FiO2</div>
                                <div class="trend-indicator" id="trendPO2FiO2">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartPO2FiO2"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">pH Arterial</div>
                                <div class="trend-indicator" id="trendPH">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartPH"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">pCO2</div>
                                <div class="trend-indicator" id="trendPCO2">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartPCO2"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">HCO3</div>
                                <div class="trend-indicator" id="trendHCO3">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartHCO3"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">PEEP e FiO2</div>
                                <div class="trend-indicator" id="trendVentilacao">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartVentilacao"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Metab√≥lico -->
                    <div id="metabolic" class="tab-content">
                        <div class="chart-grid">
                            <div class="chart-container">
                                <div class="chart-title">Glicemias</div>
                                <div class="trend-indicator" id="trendGlicemia">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartGlicemia"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Eletr√≥litos</div>
                                <div class="trend-indicator" id="trendEletrolitos">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartEletrolitos"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Hemograma</div>
                                <div class="trend-indicator" id="trendHemograma">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartHemograma"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Renal -->
                    <div id="renal" class="tab-content">
                        <div class="chart-grid">
                            <div class="chart-container">
                                <div class="chart-title">Fun√ß√£o Renal</div>
                                <div class="trend-indicator" id="trendRenal">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartRenal"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Balan√ßo H√≠drico</div>
                                <div class="trend-indicator" id="trendBalanco">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartBalanco"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Nutricional -->
                    <div id="nutrition" class="tab-content">
                        <div class="chart-grid">
                            <div class="chart-container">
                                <div class="chart-title">Tipo de Dieta</div>
                                <div class="trend-indicator" id="trendDieta">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartDieta"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Peso Corporal</div>
                                <div class="trend-indicator" id="trendPeso">Est√°vel</div>
                                <div class="chart-canvas">
                                    <canvas id="chartPeso"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Antibi√≥ticos Timeline -->
                    <div class="chart-container" style="margin-top: 20px;">
                        <div class="chart-title">Timeline de Antibi√≥ticos</div>
                        <div class="chart-canvas">
                            <canvas id="chartAntibioticos"></canvas>
                        </div>
                    </div>

                    <!-- Exporta√ß√£o de Relat√≥rios -->
                    <div class="export-section">
                        <h3>üìÑ Exportar Relat√≥rios</h3>
                        <button type="button" class="export-btn" onclick="exportarRelatorioCompleto()">üìä Relat√≥rio Completo</button>
                        <button type="button" class="export-btn" onclick="exportarGraficos()">üìà Apenas Gr√°ficos</button>
                        <button type="button" class="export-btn" onclick="exportarTendencias()">üìâ An√°lise de Tend√™ncias</button>
                    </div>
                </div>

                <!-- SOFA Score -->
                <div class="section">
                    <div class="sofa-score">
                        <h3>SOFA Score</h3>
                        <div class="score" id="sofaScoreTotal">0</div>
                        <p>Pontua√ß√£o calculada automaticamente</p>
                    </div>
                </div>

                <!-- Sugest√µes Autom√°ticas de Conduta -->
                <div class="section">
                    <div class="suggestion-box" id="suggestionBox">
                        <h3>üí° Sugest√µes de Conduta e Prescri√ß√£o</h3>
                        <div id="autoSuggestions">
                            <p style="text-align: center; opacity: 0.7;">Sugest√µes aparecer√£o aqui baseadas nos dados preenchidos</p>
                        </div>
                    </div>
                </div>

                <!-- Conduta e Prescri√ß√£o Manual -->
                <div class="section">
                    <h2 class="section-title">üìù Conduta e Prescri√ß√£o M√©dica</h2>
                    <div class="form-group">
                        <label for="condutaGeral">Conduta Geral</label>
                        <textarea id="condutaGeral" name="condutaGeral" placeholder="Descreva a conduta geral para o paciente..." style="min-height: 120px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="prescricaoMedica">Prescri√ß√£o M√©dica</label>
                        <textarea id="prescricaoMedica" name="prescricaoMedica" placeholder="Prescri√ß√£o m√©dica detalhada..." style="min-height: 150px;"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <label for="metaTerapeutica">Meta Terap√™utica 24h</label>
                            <textarea id="metaTerapeutica" name="metaTerapeutica" placeholder="Metas para as pr√≥ximas 24 horas..."></textarea>
                        </div>
                        <div class="form-col">
                            <label for="criteriosAlta">Crit√©rios de Alta</label>
                            <textarea id="criteriosAlta" name="criteriosAlta" placeholder="Crit√©rios para alta da UTI..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="submit-container">
                    <button type="button" class="submit-btn" onclick="salvarRascunho()" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); margin-right: 15px;">
                        üíæ Salvar Rascunho
                    </button>
                    <button type="button" class="submit-btn" onclick="toggleDashboard()" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); margin-right: 15px;">
                        üìä Ver Dashboard
                    </button>
                    <button type="submit" class="submit-btn">
                        üìÑ Gerar Evolu√ß√£o DOCX
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- A√ß√µes R√°pidas -->
    <div class="quick-actions">
        <button type="button" class="quick-btn" onclick="toggleDashboard()" title="Ctrl+D">üìä Dashboard</button>
        <button type="button" class="quick-btn" onclick="toggleDebugPanel()" title="Debug PDF">üîç Debug PDF</button>
        <button type="button" class="quick-btn" onclick="autoPreenchimento()" title="Ctrl+F">üöÄ Auto-Completar</button>
        <button type="button" class="quick-btn" onclick="calcularTodos()" title="Ctrl+C">üßÆ Calcular Tudo</button>
        <button type="button" class="quick-btn" onclick="validarFormulario()" title="Ctrl+V">‚úÖ Validar</button>
        <button type="button" class="quick-btn" onclick="toggleAtalhos()" title="Ctrl+H">‚å®Ô∏è Atalhos</button>
        <button type="button" class="quick-btn" onclick="limparFormulario()" title="Ctrl+L">üóëÔ∏è Limpar</button>
    </div>

    <!-- Indicador de salvamento autom√°tico -->
    <div class="auto-save-indicator" id="autoSaveIndicator">
        ‚úÖ Rascunho salvo automaticamente
    </div>

    <!-- Atalhos de teclado -->
    <div class="keyboard-shortcuts" id="keyboardShortcuts">
        <strong>Atalhos:</strong><br>
        Ctrl+D: Dashboard | Ctrl+F: Auto-completar<br>
        Ctrl+C: Calcular | Ctrl+V: Validar<br>
        Ctrl+S: Salvar | Ctrl+H: Mostrar/ocultar atalhos
    </div>

    <script>
        // Vari√°veis globais
        let dadosFormulario = {};
        let autoSaveTimer;
        let validationTimer;
        let dadosHistoricos = JSON.parse(localStorage.getItem('evolucaoUTI_historico') || '[]');
        let chartInstances = {};

        // Templates r√°pidos
        const templates = {
            pos_operatorio: {
                motivoInternacao: "Paciente submetido a procedimento cir√∫rgico, transferido para UTI para monitoriza√ß√£o p√≥s-operat√≥ria.",
                problemasAtivos: ["pos_operatorio"],
                evolucaoDia: "Paciente em p√≥s-operat√≥rio imediato, est√°vel hemodinamicamente.",
                condutaGeral: "Monitoriza√ß√£o cont√≠nua, controle da dor, profilaxia de TVP, fisioterapia respirat√≥ria."
            },
            sepse: {
                problemasAtivos: ["sepse"],
                febril: "sim",
                sepse: "sim",
                evolucaoDia: "Paciente com quadro s√©ptico, necessitando suporte intensivo.",
                condutaGeral: "Protocolo de sepse: coleta de culturas, antibioticoterapia emp√≠rica, ressuscita√ß√£o vol√™mica."
            },
            ira: {
                problemasAtivos: ["ira_aguda"],
                evolucaoDia: "Paciente apresentando insufici√™ncia renal aguda.",
                condutaGeral: "Controle rigoroso de diurese, balan√ßo h√≠drico, ajuste de medica√ß√µes, considerar di√°lise."
            },
            vm: {
                suporteResp: "vm_iot",
                evolucaoDia: "Paciente em ventila√ß√£o mec√¢nica invasiva.",
                condutaGeral: "Estrat√©gia protetora pulmonar, seda√ß√£o adequada, desmame gradual conforme evolu√ß√£o."
            },
            trauma: {
                problemasAtivos: ["tce"],
                evolucaoDia: "Paciente v√≠tima de trauma, necessitando monitoriza√ß√£o intensiva.",
                condutaGeral: "Abordagem ATLS, controle de press√£o intracraniana, monitoriza√ß√£o neurol√≥gica."
            }
        };

        // Configura√ß√£o padr√£o dos gr√°ficos
        const chartDefaultConfig = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: { color: 'white' }
                }
            },
            scales: {
                x: {
                    ticks: { color: 'white' },
                    grid: { color: 'rgba(255,255,255,0.1)' }
                },
                y: {
                    ticks: { color: 'white' },
                    grid: { color: 'rgba(255,255,255,0.1)' }
                }
            }
        };

        // Fun√ß√£o para mostrar/ocultar campos condicionais
        function toggleConditionalField(triggerName, triggerValue, targetId) {
            const radios = document.querySelectorAll(`input[name="${triggerName}"]`);
            const targetField = document.getElementById(targetId);
            
            radios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === triggerValue) {
                        targetField.classList.add('show');
                    } else {
                        targetField.classList.remove('show');
                    }
                    gerarSugestoes();
                });
            });
        }

        // Fun√ß√£o para campos condicionais de checkbox
        function toggleConditionalFieldCheckbox(triggerName, targetId) {
            const checkbox = document.querySelector(`input[name="${triggerName}"]`);
            const targetField = document.getElementById(targetId);
            
            if (checkbox && targetField) {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        targetField.classList.add('show');
                    } else {
                        targetField.classList.remove('show');
                    }
                    gerarSugestoes();
                });
            }
        }

        // Dashboard Functions
        function toggleDashboard() {
            const dashboard = document.getElementById('dashboardSection');
            const isVisible = dashboard.style.display !== 'none';
            
            if (isVisible) {
                dashboard.style.display = 'none';
            } else {
                dashboard.style.display = 'block';
                carregarDashboard();
            }
        }

        function showTab(tabName) {
            // Esconder todas as tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar tab selecionada
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function carregarDashboard() {
            // Verificar se h√° dados hist√≥ricos
            if (dadosHistoricos.length === 0) {
                adicionarDadosDemo();
            }
            
            criarGraficos();
            analisarTendencias();
        }

        function adicionarDadosDemo() {
            // Gerar dados de demonstra√ß√£o para 7 dias
            const hoje = new Date();
            const dadosDemo = [];
            
            for (let i = 6; i >= 0; i--) {
                const data = new Date(hoje);
                data.setDate(data.getDate() - i);
                
                dadosDemo.push({
                    data: data.toISOString().split('T')[0],
                    rass: Math.floor(Math.random() * 8) - 4, // -4 a +4
                    glasgow: 10 + Math.floor(Math.random() * 6), // 10-15
                    pam: 65 + Math.floor(Math.random() * 25), // 65-90
                    lactato: 1 + Math.random() * 3, // 1-4
                    noradrenalina: Math.random() * 0.3, // 0-0.3
                    fc: 70 + Math.floor(Math.random() * 40), // 70-110
                    po2fio2: 200 + Math.floor(Math.random() * 200), // 200-400
                    ph: 7.25 + Math.random() * 0.25, // 7.25-7.5
                    pco2: 30 + Math.floor(Math.random() * 20), // 30-50
                    hco3: 18 + Math.floor(Math.random() * 10), // 18-28
                    peep: 5 + Math.floor(Math.random() * 10), // 5-15
                    fio2: 40 + Math.floor(Math.random() * 40), // 40-80
                    glicemiaJejum: 80 + Math.floor(Math.random() * 100), // 80-180
                    creatinina: 0.8 + Math.random() * 2, // 0.8-2.8
                    ureia: 30 + Math.floor(Math.random() * 50), // 30-80
                    sodio: 135 + Math.floor(Math.random() * 10), // 135-145
                    potassio: 3.5 + Math.random() * 1.5, // 3.5-5.0
                    hemoglobina: 8 + Math.random() * 4, // 8-12
                    leucocitos: 5000 + Math.floor(Math.random() * 10000), // 5k-15k
                    plaquetas: 100000 + Math.floor(Math.random() * 200000), // 100k-300k
                    diurese: 1000 + Math.floor(Math.random() * 1500), // 1000-2500ml
                    balancoHidrico: -500 + Math.floor(Math.random() * 1000), // -500 a +500
                    peso: 70 + Math.floor(Math.random() * 20), // 70-90kg
                    tipoDieta: Math.random() > 0.5 ? 'enteral' : 'parenteral',
                    sofaScore: Math.floor(Math.random() * 15), // 0-15
                    antibioticos: ['ceftriaxone', 'vancomicina'][Math.floor(Math.random() * 2)]
                });
            }
            
            dadosHistoricos = dadosDemo;
            localStorage.setItem('evolucaoUTI_historico', JSON.stringify(dadosHistoricos));
            
            criarGraficos();
            analisarTendencias();
        }

        function salvarEvolucao() {
            const formData = new FormData(document.getElementById('evolucaoForm'));
            const dadosDia = {
                data: new Date().toISOString().split('T')[0],
                rass: document.getElementById('rass').value || 0,
                glasgow: document.getElementById('glasgowTotal').value || 15,
                pam: document.getElementById('pamCalculada').value || 0,
                lactato: document.getElementById('lactato').value || 0,
                noradrenalina: document.getElementById('doseVasoNoradrenalina').value || 0,
                fc: document.getElementById('fc').value || 0,
                po2fio2: document.getElementById('relacaoPoFio').value || 0,
                ph: document.getElementById('ph').value || 0,
                pco2: document.getElementById('pco2').value || 0,
                hco3: document.getElementById('hco3').value || 0,
                peep: document.getElementById('peep').value || 0,
                fio2: document.getElementById('fio2').value || 0,
                glicemiaJejum: document.getElementById('glicemiaJejum').value || 0,
                creatinina: document.getElementById('cr').value || 0,
                ureia: document.getElementById('ur').value || 0,
                sodio: document.getElementById('na').value || 0,
                potassio: document.getElementById('k').value || 0,
                hemoglobina: document.getElementById('hemoglobina').value || 0,
                leucocitos: document.getElementById('leuco').value || 0,
                plaquetas: document.getElementById('examPlaquetas').value || 0,
                diurese: document.getElementById('diurese24h').value || 0,
                balancoHidrico: document.getElementById('balancoHidrico').value || 0,
                peso: document.getElementById('peso').value || 0,
                tipoDieta: document.getElementById('tipoDiseta').value || '',
                sofaScore: document.getElementById('sofaScoreTotal').textContent || 0,
                antibioticos: Array.from(document.querySelectorAll('input[name="antibioticos[]"]:checked')).map(cb => cb.value)
            };
            
            // Remover entrada do mesmo dia se existir
            dadosHistoricos = dadosHistoricos.filter(d => d.data !== dadosDia.data);
            dadosHistoricos.push(dadosDia);
            dadosHistoricos.sort((a, b) => new Date(a.data) - new Date(b.data));
            
            localStorage.setItem('evolucaoUTI_historico', JSON.stringify(dadosHistoricos));
            
            alert('‚úÖ Evolu√ß√£o do dia salva com sucesso!');
            carregarDashboard();
        }

        function criarGraficos() {
            if (dadosHistoricos.length === 0) return;
            
            const labels = dadosHistoricos.map(d => new Date(d.data).toLocaleDateString('pt-BR'));
            
            // Destruir gr√°ficos existentes
            Object.values(chartInstances).forEach(chart => {
                if (chart) chart.destroy();
            });
            chartInstances = {};
            
            // RASS
            chartInstances.rass = new Chart(document.getElementById('chartRass'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'RASS',
                        data: dadosHistoricos.map(d => d.rass),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    ...chartDefaultConfig,
                    scales: {
                        ...chartDefaultConfig.scales,
                        y: {
                            ...chartDefaultConfig.scales.y,
                            min: -5,
                            max: 4,
                            ticks: {
                                ...chartDefaultConfig.scales.y.ticks,
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            // Glasgow
            chartInstances.glasgow = new Chart(document.getElementById('chartGlasgow'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Glasgow',
                        data: dadosHistoricos.map(d => d.glasgow),
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    ...chartDefaultConfig,
                    scales: {
                        ...chartDefaultConfig.scales,
                        y: {
                            ...chartDefaultConfig.scales.y,
                            min: 3,
                            max: 15
                        }
                    }
                }
            });
            
            // PAM
            chartInstances.pam = new Chart(document.getElementById('chartPAM'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'PAM (mmHg)',
                        data: dadosHistoricos.map(d => d.pam),
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    ...chartDefaultConfig,
                    plugins: {
                        ...chartDefaultConfig.plugins,
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    yMin: 65,
                                    yMax: 65,
                                    borderColor: 'rgba(255, 255, 255, 0.5)',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        content: 'Meta: 65 mmHg',
                                        enabled: true
                                    }
                                }
                            }
                        }
                    }
                }
            });
            
            // Lactato
            chartInstances.lactato = new Chart(document.getElementById('chartLactato'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Lactato (mmol/L)',
                        data: dadosHistoricos.map(d => d.lactato),
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: chartDefaultConfig
            });
            
            // Noradrenalina
            chartInstances.noradrenalina = new Chart(document.getElementById('chartNoradrenalina'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Noradrenalina (mcg/kg/min)',
                        data: dadosHistoricos.map(d => d.noradrenalina),
                        borderColor: '#9b59b6',
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: chartDefaultConfig
            });
            
            // FC
            chartInstances.fc = new Chart(document.getElementById('chartFC'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'FC (bpm)',
                        data: dadosHistoricos.map(d => d.fc),
                        borderColor: '#e67e22',
                        backgroundColor: 'rgba(230, 126, 34, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: chartDefaultConfig
            });
            
            // pO2/FiO2
            chartInstances.po2fio2 = new Chart(document.getElementById('chartPO2FiO2'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'pO2/FiO2',
                        data: dadosHistoricos.map(d => d.po2fio2),
                        borderColor: '#1abc9c',
                        backgroundColor: 'rgba(26, 188, 156, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: chartDefaultConfig
            });
            
            // pH
            chartInstances.ph = new Chart(document.getElementById('chartPH'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'pH',
                        data: dadosHistoricos.map(d => d.ph),
                        borderColor: '#34495e',
                        backgroundColor: 'rgba(52, 73, 94, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    ...chartDefaultConfig,
                    scales: {
                        ...chartDefaultConfig.scales,
                        y: {
                            ...chartDefaultConfig.scales.y,
                            min: 7.0,
                            max: 7.6
                        }
                    }
                }
            });
            
            // pCO2
            chartInstances.pco2 = new Chart(document.getElementById('chartPCO2'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'pCO2 (mmHg)',
                        data: dadosHistoricos.map(d => d.pco2),
                        borderColor: '#95a5a6',
                        backgroundColor: 'rgba(149, 165, 166, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: chartDefaultConfig
            });
            
            // HCO3
            chartInstances.hco3 = new Chart(document.getElementById('chartHCO3'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'HCO3 (mEq/L)',
                        data: dadosHistoricos.map(d => d.hco3),
                        borderColor: '#16a085',
                        backgroundColor: 'rgba(22, 160, 133, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: chartDefaultConfig
            });
            
            // Ventila√ß√£o (PEEP e FiO2)
            chartInstances.ventilacao = new Chart(document.getElementById('chartVentilacao'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'PEEP (cmH2O)',
                        data: dadosHistoricos.map(d => d.peep),
                        borderColor: '#8e44ad',
                        yAxisID: 'y'
                    }, {
                        label: 'FiO2 (%)',
                        data: dadosHistoricos.map(d => d.fio2),
                        borderColor: '#d35400',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    ...chartDefaultConfig,
                    scales: {
                        x: chartDefaultConfig.scales.x,
                        y: {
                            ...chartDefaultConfig.scales.y,
                            type: 'linear',
                            display: true,
                            position: 'left',
                        },
                        y1: {
                            ...chartDefaultConfig.scales.y,
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
            
            // Glicemias
            chartInstances.glicemia = new Chart(document.getElementById('chartGlicemia'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Glicemia Jejum (mg/dL)',
                        data: dadosHistoricos.map(d => d.glicemiaJejum),
                        borderColor: '#c0392b',
                        backgroundColor: 'rgba(192, 57, 43, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: chartDefaultConfig
            });
            
            // Eletr√≥litos
            chartInstances.eletrolitos = new Chart(document.getElementById('chartEletrolitos'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'S√≥dio (mEq/L)',
                        data: dadosHistoricos.map(d => d.sodio),
                        borderColor: '#2980b9',
                        yAxisID: 'y'
                    }, {
                        label: 'Pot√°ssio (mEq/L)',
                        data: dadosHistoricos.map(d => d.potassio),
                        borderColor: '#27ae60',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    ...chartDefaultConfig,
                    scales: {
                        x: chartDefaultConfig.scales.x,
                        y: {
                            ...chartDefaultConfig.scales.y,
                            type: 'linear',
                            display: true,
                            position: 'left',
                            min: 130,
                            max: 150
                        },
                        y1: {
                            ...chartDefaultConfig.scales.y,
                            type: 'linear',
                            display: true,
                            position: 'right',
                            min: 3,
                            max: 6,
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
            
            // Hemograma
            chartInstances.hemograma = new Chart(document.getElementById('chartHemograma'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Hemoglobina (g/dL)',
                        data: dadosHistoricos.map(d => d.hemoglobina),
                        borderColor: '#e74c3c',
                        yAxisID: 'y'
                    }, {
                        label: 'Leuc√≥citos (x1000)',
                        data: dadosHistoricos.map(d => d.leucocitos / 1000),
                        borderColor: '#3498db',
                        yAxisID: 'y1'
                    }, {
                        label: 'Plaquetas (x1000)',
                        data: dadosHistoricos.map(d => d.plaquetas / 1000),
                        borderColor: '#9b59b6',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    ...chartDefaultConfig,
                    scales: {
                        x: chartDefaultConfig.scales.x,
                        y: {
                            ...chartDefaultConfig.scales.y,
                            type: 'linear',
                            display: true,
                            position: 'left',
                        },
                        y1: {
                            ...chartDefaultConfig.scales.y,
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
            
            // Fun√ß√£o Renal
            chartInstances.renal = new Chart(document.getElementById('chartRenal'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Creatinina (mg/dL)',
                        data: dadosHistoricos.map(d => d.creatinina),
                        borderColor: '#e67e22',
                        yAxisID: 'y'
                    }, {
                        label: 'Ureia (mg/dL)',
                        data: dadosHistoricos.map(d => d.ureia),
                        borderColor: '#34495e',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    ...chartDefaultConfig,
                    scales: {
                        x: chartDefaultConfig.scales.x,
                        y: {
                            ...chartDefaultConfig.scales.y,
                            type: 'linear',
                            display: true,
                            position: 'left',
                        },
                        y1: {
                            ...chartDefaultConfig.scales.y,
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
            
            // Balan√ßo H√≠drico
            chartInstances.balanco = new Chart(document.getElementById('chartBalanco'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Diurese (mL)',
                        data: dadosHistoricos.map(d => d.diurese),
                        backgroundColor: 'rgba(52, 152, 219, 0.6)',
                        yAxisID: 'y'
                    }, {
                        label: 'Balan√ßo (mL)',
                        data: dadosHistoricos.map(d => d.balancoHidrico),
                        backgroundColor: 'rgba(231, 76, 60, 0.6)',
                        yAxisID: 'y'
                    }]
                },
                options: {
                    ...chartDefaultConfig,
                    scales: {
                        x: chartDefaultConfig.scales.x,
                        y: {
                            ...chartDefaultConfig.scales.y,
                            type: 'linear',
                            display: true,
                            position: 'left',
                        }
                    }
                }
            });
            
            // Tipo de Dieta
            const dietaData = dadosHistoricos.reduce((acc, d) => {
                acc[d.tipoDieta] = (acc[d.tipoDieta] || 0) + 1;
                return acc;
            }, {});
            
            chartInstances.dieta = new Chart(document.getElementById('chartDieta'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(dietaData),
                    datasets: [{
                        data: Object.values(dietaData),
                        backgroundColor: ['#3498db', '#e74c3c', '#f39c12']
                    }]
                },
                options: {
                    ...chartDefaultConfig,
                    scales: {}
                }
            });
            
            // Peso (dados simulados)
            chartInstances.peso = new Chart(document.getElementById('chartPeso'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Peso (kg)',
                        data: dadosHistoricos.map(d => d.peso),
                        borderColor: '#16a085',
                        backgroundColor: 'rgba(22, 160, 133, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: chartDefaultConfig
            });
            
            // Timeline de Antibi√≥ticos
            const antibioticosTimeline = dadosHistoricos.map((d, index) => ({
                x: index,
                y: 1,
                antibiotico: d.antibioticos
            }));
            
            chartInstances.antibioticos = new Chart(document.getElementById('chartAntibioticos'), {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Antibi√≥ticos',
                        data: antibioticosTimeline,
                        backgroundColor: function(context) {
                            const value = context.parsed.y;
                            return value ? '#e74c3c' : '#95a5a6';
                        },
                        pointRadius: 8
                    }]
                },
                options: {
                    ...chartDefaultConfig,
                    scales: {
                        x: {
                            ...chartDefaultConfig.scales.x,
                            type: 'linear',
                            ticks: {
                                ...chartDefaultConfig.scales.x.ticks,
                                callback: function(value) {
                                    return labels[value] || '';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const data = antibioticosTimeline[context.dataIndex];
                                    return `Antibi√≥ticos: ${data.antibiotico}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function analisarTendencias() {
            if (dadosHistoricos.length < 2) return;
            
            const alertas = [];
            const ultimosDias = dadosHistoricos.slice(-3); // √öltimos 3 dias
            
            // Fun√ß√£o para calcular tend√™ncia
            function calcularTendencia(valores) {
                if (valores.length < 2) return 'stable';
                const ultimo = valores[valores.length - 1];
                const penultimo = valores[valores.length - 2];
                const diferenca = ultimo - penultimo;
                const percentual = Math.abs(diferenca / penultimo) * 100;
                
                if (percentual < 5) return 'stable';
                return diferenca > 0 ? 'up' : 'down';
            }
            
            // Analisar cada par√¢metro
            const parametros = {
                lactato: { valores: ultimosDias.map(d => d.lactato), limite: 2, tipo: 'menor_melhor' },
                pam: { valores: ultimosDias.map(d => d.pam), limite: 65, tipo: 'maior_melhor' },
                glasgow: { valores: ultimosDias.map(d => d.glasgow), limite: 13, tipo: 'maior_melhor' },
                po2fio2: { valores: ultimosDias.map(d => d.po2fio2), limite: 300, tipo: 'maior_melhor' },
                creatinina: { valores: ultimosDias.map(d => d.creatinina), limite: 1.2, tipo: 'menor_melhor' },
                sofaScore: { valores: ultimosDias.map(d => d.sofaScore), limite: 6, tipo: 'menor_melhor' }
            };
            
            Object.keys(parametros).forEach(param => {
                const dados = parametros[param];
                const tendencia = calcularTendencia(dados.valores);
                const valorAtual = dados.valores[dados.valores.length - 1];
                
                // Atualizar indicador visual
                const indicator = document.getElementById(`trend${param.charAt(0).toUpperCase() + param.slice(1)}`);
                if (indicator) {
                    indicator.className = `trend-indicator trend-${tendencia}`;
                    indicator.textContent = tendencia === 'up' ? '‚ÜóÔ∏è Subindo' : 
                                          tendencia === 'down' ? '‚ÜòÔ∏è Descendo' : '‚û°Ô∏è Est√°vel';
                }
                
                // Gerar alertas
                if (dados.tipo === 'menor_melhor') {
                    if (valorAtual > dados.limite && tendencia === 'up') {
                        alertas.push({
                            parametro: param,
                            tipo: 'piora',
                            mensagem: `${param.toUpperCase()} em eleva√ß√£o (${valorAtual}) - tend√™ncia preocupante`
                        });
                    }
                } else {
                    if (valorAtual < dados.limite && tendencia === 'down') {
                        alertas.push({
                            parametro: param,
                            tipo: 'piora',
                            mensagem: `${param.toUpperCase()} em queda (${valorAtual}) - tend√™ncia preocupante`
                        });
                    }
                }
            });
            
            // Mostrar alertas
            if (alertas.length > 0) {
                const alertPanel = document.getElementById('alertPanel');
                const alertContent = document.getElementById('alertContent');
                
                alertContent.innerHTML = alertas.map(alerta => `
                    <div class="alert-item">
                        <h4>‚ö†Ô∏è ${alerta.parametro.toUpperCase()}</h4>
                        <p>${alerta.mensagem}</p>
                    </div>
                `).join('');
                
                alertPanel.style.display = 'block';
            }
        }

        function filtrarPeriodo() {
            const dataInicio = document.getElementById('dataInicio').value;
            const dataFim = document.getElementById('dataFim').value;
            
            if (dataInicio && dataFim) {
                const dadosFiltrados = dadosHistoricos.filter(d => {
                    return d.data >= dataInicio && d.data <= dataFim;
                });
                
                if (dadosFiltrados.length > 0) {
                    const dadosOriginais = [...dadosHistoricos];
                    dadosHistoricos = dadosFiltrados;
                    criarGraficos();
                    dadosHistoricos = dadosOriginais;
                }
            }
        }

        function exportarRelatorioCompleto() {
            // Gerar relat√≥rio completo com gr√°ficos e an√°lises
            const relatorio = {
                data: new Date().toISOString(),
                paciente: document.getElementById('nome').value || 'Paciente UTI',
                periodo: `${dadosHistoricos[0]?.data} a ${dadosHistoricos[dadosHistoricos.length - 1]?.data}`,
                dados: dadosHistoricos,
                alertas: document.getElementById('alertContent').innerHTML
            };
            
            const blob = new Blob([JSON.stringify(relatorio, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `relatorio_evolucao_${relatorio.paciente.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        function exportarGraficos() {
            // Criar PDF com gr√°ficos (simplificado)
            alert('üìä Funcionalidade de exporta√ß√£o de gr√°ficos em desenvolvimento.\nPor enquanto, use Print Screen para capturar os gr√°ficos.');
        }

        function exportarTendencias() {
            // Exportar an√°lise de tend√™ncias
            const tendencias = {
                data: new Date().toISOString(),
                analise: 'An√°lise autom√°tica de tend√™ncias',
                alertas: document.getElementById('alertContent').innerHTML || 'Nenhum alerta identificado'
            };
            
            const blob = new Blob([JSON.stringify(tendencias, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `analise_tendencias_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        // Aplicar template r√°pido
        function aplicarTemplate(tipo) {
            const template = templates[tipo];
            if (!template) return;

            // Aplicar campos do template
            Object.keys(template).forEach(key => {
                const elemento = document.querySelector(`[name="${key}"]`);
                if (elemento) {
                    if (elemento.type === 'checkbox' || elemento.type === 'radio') {
                        if (Array.isArray(template[key])) {
                            template[key].forEach(value => {
                                const checkbox = document.querySelector(`[name="${key}"][value="${value}"]`);
                                if (checkbox) checkbox.checked = true;
                            });
                        } else {
                            const radio = document.querySelector(`[name="${key}"][value="${template[key]}"]`);
                            if (radio) radio.checked = true;
                        }
                    } else {
                        elemento.value = template[key];
                    }
                }
            });

            // Trigger eventos para atualizar campos condicionais
            document.querySelectorAll('input[type="radio"]:checked').forEach(radio => {
                radio.dispatchEvent(new Event('change'));
            });

            atualizarProgresso();
            gerarSugestoes();
            mostrarIndicadorSave();
        }

        // Upload e processamento de PDF
        let ultimoTextoExtraido = '';

        function configurarUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                processarArquivos(e.dataTransfer.files);
            });

            fileInput.addEventListener('change', (e) => {
                processarArquivos(e.target.files);
            });
        }

        async function processarArquivos(files) {
            const status = document.getElementById('uploadStatus');
            
            if (files.length === 0) {
                status.innerHTML = '<p style="color: #ffc107;">‚ö†Ô∏è Nenhum arquivo selecionado</p>';
                return;
            }

            status.innerHTML = `<p style="color: #17a2b8;">üîÑ Processando ${files.length} arquivo(s)...</p>`;

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                status.innerHTML += `<div id="status-${i}" style="margin: 8px 0; padding: 8px; background: #f8f9fa; border-radius: 5px;">
                    üìÑ <strong>${file.name}</strong> (${(file.size / 1024).toFixed(1)} KB)<br>
                    <span style="color: #17a2b8;">üîÑ Processando...</span>
                </div>`;

                if (file.type === 'application/pdf') {
                    try {
                        const statusDiv = document.getElementById(`status-${i}`);
                        statusDiv.innerHTML = `üìÑ <strong>${file.name}</strong> (${(file.size / 1024).toFixed(1)} KB)<br>
                            <span style="color: #17a2b8;">üîÑ Extraindo texto do PDF...</span>`;

                        await processarPDF(file);
                        
                        statusDiv.innerHTML = `üìÑ <strong>${file.name}</strong> (${(file.size / 1024).toFixed(1)} KB)<br>
                            <span style="color: #28a745;">‚úÖ Processado com sucesso!</span>`;
                            
                    } catch (error) {
                        console.error('Erro ao processar PDF:', error);
                        const statusDiv = document.getElementById(`status-${i}`);
                        statusDiv.innerHTML = `üìÑ <strong>${file.name}</strong> (${(file.size / 1024).toFixed(1)} KB)<br>
                            <span style="color: #dc3545;">‚ùå Erro: ${error.message}</span><br>
                            <small style="color: #6c757d;">Dica: Tente "Testar PDF Simulado" para verificar se a funcionalidade est√° funcionando</small>`;
                    }
                } else {
                    const statusDiv = document.getElementById(`status-${i}`);
                    statusDiv.innerHTML = `üìÑ <strong>${file.name}</strong><br>
                        <span style="color: #ffc107;">‚ö†Ô∏è Tipo de arquivo n√£o suportado</span><br>
                        <small style="color: #6c757d;">Apenas arquivos PDF s√£o aceitos</small>`;
                }
            }

            // Limpar status ap√≥s 15 segundos
            setTimeout(() => {
                const statusElements = status.querySelectorAll('[id^="status-"]');
                statusElements.forEach(el => {
                    if (el.innerHTML.includes('‚úÖ')) {
                        el.style.opacity = '0.7';
                        el.style.transition = 'opacity 2s';
                    }
                });
            }, 15000);

            // Limpar completamente ap√≥s 30 segundos
            setTimeout(() => {
                status.innerHTML = '';
            }, 30000);
        }

        async function processarPDF(file) {
            try {
                // Verificar e carregar PDF.js se necess√°rio
                await garantirPDFJS();

                const arrayBuffer = await file.arrayBuffer();
                const loadingTask = pdfjsLib.getDocument(arrayBuffer);
                
                // Monitorar progresso do carregamento
                loadingTask.onProgress = function(progress) {
                    if (progress.total > 0) {
                        const percent = Math.round((progress.loaded / progress.total) * 100);
                        console.log(`Carregando PDF: ${percent}%`);
                    }
                };

                const pdf = await loadingTask.promise;
                let textoCompleto = '';
                let textoEncontrado = false;

                console.log(`PDF carregado: ${pdf.numPages} p√°ginas`);

                for (let i = 1; i <= pdf.numPages; i++) {
                    try {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        
                        if (textContent.items.length > 0) {
                            const pageText = textContent.items.map(item => {
                                // Preservar espa√ßamento e quebras de linha
                                return item.str;
                            }).join(' ');
                            
                            if (pageText.trim().length > 0) {
                                textoCompleto += `--- P√ÅGINA ${i} ---\n${pageText}\n\n`;
                                textoEncontrado = true;
                                console.log(`P√°gina ${i}: ${pageText.length} caracteres extra√≠dos`);
                            }
                        } else {
                            console.log(`P√°gina ${i}: Sem texto detectado (pode ser imagem)`);
                        }
                    } catch (pageError) {
                        console.error(`Erro na p√°gina ${i}:`, pageError);
                        textoCompleto += `--- P√ÅGINA ${i} ---\nERRO: ${pageError.message}\n\n`;
                    }
                }

                console.log('Texto extra√≠do completo:', textoCompleto);
                ultimoTextoExtraido = textoCompleto;

                // Verificar se algum texto foi encontrado
                if (!textoEncontrado || textoCompleto.trim().length < 10) {
                    mostrarDebugPanel(textoCompleto);
                    throw new Error('PDF n√£o cont√©m texto leg√≠vel. Pode ser um documento escaneado (imagem). Tente com um PDF gerado digitalmente.');
                }

                // Mostrar debug panel
                mostrarDebugPanel(textoCompleto);

                // Processar o texto
                const dadosEncontrados = preencherExamesAutomaticamente(textoCompleto);
                
                if (dadosEncontrados > 0) {
                    mostrarIndicadorSave();
                    
                    // Listar quais campos foram preenchidos
                    const camposPreenchidos = obterCamposPreenchidos();
                    const listaCampos = camposPreenchidos.length > 0 ? 
                        '\n\nCampos preenchidos:\n‚Ä¢ ' + camposPreenchidos.join('\n‚Ä¢ ') : '';
                    
                    alert(`‚úÖ Sucesso! Encontrados ${dadosEncontrados} valores de exames!${listaCampos}\n\n‚ö†Ô∏è Sempre verifique se os valores est√£o corretos antes de usar.`);
                } else {
                    const sugestoes = analisarPorqueNaoEncontrou(textoCompleto);
                    alert(`‚ö†Ô∏è Nenhum valor reconhecido automaticamente.\n\n${sugestoes}\n\nUse o painel de debug para an√°lise detalhada.`);
                }

            } catch (error) {
                console.error('Erro detalhado:', error);
                let mensagemErro = 'Erro desconhecido';
                
                if (error.message.includes('PDF.js n√£o foi carregado')) {
                    mensagemErro = 'Erro ao carregar biblioteca PDF.js. Verifique sua conex√£o com a internet.';
                } else if (error.message.includes('Invalid PDF') || error.message.includes('InvalidPDFException')) {
                    mensagemErro = 'Arquivo PDF corrompido ou inv√°lido. Tente com outro arquivo.';
                } else if (error.message.includes('n√£o cont√©m texto leg√≠vel')) {
                    mensagemErro = error.message;
                } else if (error.message.includes('AbortError')) {
                    mensagemErro = 'Upload cancelado ou timeout. Tente novamente.';
                } else if (error.name === 'PasswordException') {
                    mensagemErro = 'PDF protegido por senha. Remova a prote√ß√£o e tente novamente.';
                } else {
                    mensagemErro = `Erro t√©cnico: ${error.message}`;
                }
                
                throw new Error(mensagemErro);
            }
        }

        function obterCamposPreenchidos() {
            const campos = [];
            const mapeamentosNomes = {
                'examHemoglobina': 'Hemoglobina',
                'examHematocrito': 'Hemat√≥crito',
                'examLeucocitos': 'Leuc√≥citos',
                'examPlaquetas': 'Plaquetas',
                'examUreia': 'Ureia',
                'examCreatinina': 'Creatinina',
                'examSodio': 'S√≥dio',
                'examPotassio': 'Pot√°ssio',
                'ph': 'pH',
                'po2': 'pO2',
                'pco2': 'pCO2',
                'hco3': 'HCO3',
                'lactato': 'Lactato',
                'pcr': 'PCR',
                'examTgo': 'TGO/AST',
                'examTgp': 'TGP/ALT',
                'examBilirrubina': 'Bilirrubina Total'
            };

            Object.keys(mapeamentosNomes).forEach(id => {
                const elemento = document.getElementById(id);
                if (elemento && elemento.value && elemento.value.trim() !== '') {
                    campos.push(`${mapeamentosNomes[id]}: ${elemento.value}`);
                }
            });

            return campos;
        }

        function analisarPorqueNaoEncontrou(texto) {
            const texto_upper = texto.toUpperCase();
            const sugestoes = [];

            // Verificar se h√° n√∫meros no texto
            const numeros = texto.match(/\d+[\.,]?\d*/g);
            if (!numeros || numeros.length < 5) {
                sugestoes.push('‚Ä¢ Poucos n√∫meros detectados - pode ser PDF escaneado');
            }

            // Verificar se h√° palavras-chave m√©dicas
            const palavrasChave = ['HEMOGLOBINA', 'CREATININA', 'UREIA', 'SODIO', 'LACTATO'];
            const encontradas = palavrasChave.filter(palavra => texto_upper.includes(palavra));
            
            if (encontradas.length === 0) {
                sugestoes.push('‚Ä¢ Nenhuma palavra-chave m√©dica encontrada');
                sugestoes.push('‚Ä¢ Verifique se √© um exame laboratorial v√°lido');
            } else {
                sugestoes.push(`‚Ä¢ Palavras-chave encontradas: ${encontradas.join(', ')}`);
                sugestoes.push('‚Ä¢ Formato pode n√£o estar sendo reconhecido');
            }

            // Verificar formato do laborat√≥rio
            const formato = detectarFormato(texto_upper);
            if (formato === 'generico') {
                sugestoes.push('‚Ä¢ Laborat√≥rio n√£o reconhecido - tente "Testar PDF Simulado"');
            } else {
                sugestoes.push(`‚Ä¢ Laborat√≥rio detectado: ${formato}`);
            }

            return sugestoes.length > 0 ? 
                'Poss√≠veis causas:\n' + sugestoes.join('\n') :
                'Causa n√£o identificada. Use o painel de debug.';
        }

        async function garantirPDFJS() {
            if (typeof pdfjsLib === 'undefined') {
                console.log('PDF.js n√£o encontrado, tentando carregar...');
                
                // Tentar carregar PDF.js dinamicamente
                try {
                    const script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js';
                    document.head.appendChild(script);
                    
                    // Aguardar carregamento
                    await new Promise((resolve, reject) => {
                        script.onload = resolve;
                        script.onerror = reject;
                        setTimeout(reject, 10000); // timeout 10s
                    });
                    
                    if (typeof pdfjsLib === 'undefined') {
                        throw new Error('PDF.js falhou ao carregar');
                    }
                } catch (error) {
                    throw new Error('PDF.js n√£o foi carregado. Verifique a conex√£o com a internet.');
                }
            }

            // Configurar worker do PDF.js
            if (!pdfjsLib.GlobalWorkerOptions.workerSrc) {
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
            }
        }

        function testarPDFSimulado() {
            // Simular texto extra√≠do de um PDF de laborat√≥rio t√≠pico
            const textoSimulado = `
                LABORATORIO FLEURY
                EXAMES LABORATORIAIS
                
                HEMOGRAMA COMPLETO
                HEMOGLOBINA: 12.5 g/dL
                HEMATOCRITO: 38.2 %
                LEUCOCITOS: 8500 /mm3
                NEUTROFILOS: 65 %
                LINFOCITOS: 30 %
                PLAQUETAS: 285000 /mm3
                
                BIOQUIMICA
                UREIA: 45 mg/dL
                CREATININA: 1.2 mg/dL
                SODIO: 142 mEq/L
                POTASSIO: 4.1 mEq/L
                CALCIO IONICO: 1.23 mg/dL
                
                GASOMETRIA ARTERIAL
                pH: 7.38
                pO2: 85 mmHg
                pCO2: 42 mmHg
                HCO3: 24 mEq/L
                
                MARCADORES
                LACTATO: 2.1 mg/dL
                PROTEINA C REATIVA: 8.5 mg/L
                
                ENZIMAS HEPATICAS
                TGO (AST): 32 U/L
                TGP (ALT): 28 U/L
                BILIRRUBINA TOTAL: 1.1 mg/dL
                
                COAGULACAO
                TTPA: 28.5 segundos
                INR: 1.05
            `;
            
            console.log('Testando com texto simulado...');
            ultimoTextoExtraido = textoSimulado;
            
            // Mostrar debug panel
            mostrarDebugPanel(textoSimulado);
            
            // Processar o texto
            const dadosEncontrados = preencherExamesAutomaticamente(textoSimulado);
            
            if (dadosEncontrados > 0) {
                mostrarIndicadorSave();
                alert(`‚úÖ Teste bem-sucedido!\n\nEncontrados ${dadosEncontrados} valores no PDF simulado.\n\nIsso confirma que a funcionalidade est√° funcionando.\nSe seu PDF real n√£o funcionar, pode ser:\n- Formato n√£o suportado\n- PDF escaneado (imagem)\n- Layout muito diferente`);
            } else {
                alert('‚ùå Erro no teste simulado!\n\nIsso indica um problema na funcionalidade.\nVerifique o console para mais detalhes.');
            }
        }

        function mostrarDebugPanel(texto) {
            const debugPanel = document.getElementById('pdfDebugPanel');
            const textArea = document.getElementById('pdfExtractedText');
            
            textArea.value = texto;
            debugPanel.style.display = 'block';
            
            // Adicionar estat√≠sticas do texto
            const stats = analisarTexto(texto);
            const statsDiv = document.getElementById('textStats') || criarStatsDiv();
            statsDiv.innerHTML = `
                <strong>Estat√≠sticas do texto:</strong><br>
                üìù Caracteres: ${stats.caracteres}<br>
                üìÑ Linhas: ${stats.linhas}<br>
                üî¢ N√∫meros encontrados: ${stats.numeros}<br>
                üè• Formato detectado: ${stats.formato}
            `;
            
            // Scroll para o debug panel
            debugPanel.scrollIntoView({ behavior: 'smooth' });
        }

        function criarStatsDiv() {
            const debugPanel = document.getElementById('pdfDebugPanel');
            const statsDiv = document.createElement('div');
            statsDiv.id = 'textStats';
            statsDiv.style.cssText = 'margin-top: 10px; padding: 10px; background: #e8f5e8; border-radius: 5px; font-size: 12px;';
            debugPanel.appendChild(statsDiv);
            return statsDiv;
        }

        function analisarTexto(texto) {
            const caracteres = texto.length;
            const linhas = texto.split('\n').length;
            const numeros = (texto.match(/\d+[\.,]?\d*/g) || []).length;
            const formato = detectarFormato(texto.toUpperCase());
            
            return { caracteres, linhas, numeros, formato };
        }

        function toggleDebugPanel() {
            const debugPanel = document.getElementById('pdfDebugPanel');
            debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
        }

        function reprocessarTexto() {
            if (ultimoTextoExtraido) {
                const dadosEncontrados = preencherExamesAutomaticamente(ultimoTextoExtraido);
                alert(`Reprocessamento conclu√≠do! Encontrados ${dadosEncontrados} valores.`);
            } else {
                alert('Nenhum texto dispon√≠vel para reprocessar. Fa√ßa upload de um PDF primeiro.');
            }
        }

        function preencherExamesAutomaticamente(texto) {
            console.log('Iniciando preenchimento autom√°tico...');
            let dadosEncontrados = 0;
            
            // Normalizar texto
            const textoNormalizado = texto.toUpperCase()
                .replace(/\s+/g, ' ')
                .replace(/[^\w\s\.,;:()\-]/g, ' ');

            console.log('Texto normalizado:', textoNormalizado);

            // Detectar formato do laborat√≥rio
            const formatoLab = detectarFormato(textoNormalizado);
            console.log('Formato detectado:', formatoLab);

            // Mapeamentos expandidos com m√∫ltiplas varia√ß√µes
            const mapeamentos = {
                // Hemograma
                'examHemoglobina': [
                    /HEMOGLOBINA[\s\D]*?(\d+[\.,]?\d*)/i,
                    /HB[\s\D]*?(\d+[\.,]?\d*)\s*G\s*DL/i,
                    /HGB[\s\D]*?(\d+[\.,]?\d*)/i,
                    /HEMOGLOBIN[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*G\s*DL.*?HEMOGLOBIN/i
                ],
                'examHematocrito': [
                    /HEMATOCRITO[\s\D]*?(\d+[\.,]?\d*)/i,
                    /HT[\s\D]*?(\d+[\.,]?\d*)\s*%/i,
                    /HCT[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*%.*?HEMATOCRITO/i
                ],
                'examLeucocitos': [
                    /LEUCOCITOS[\s\D]*?(\d+[\.,]?\d*)/i,
                    /GLOBULOS\s*BRANCOS[\s\D]*?(\d+[\.,]?\d*)/i,
                    /WBC[\s\D]*?(\d+[\.,]?\d*)/i,
                    /GB[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*MIL\s*MM3.*?LEUCOCITO/i,
                    /(\d+[\.,]?\d*)\s*X\s*10\s*3.*?LEUCOCITO/i
                ],
                'examNeutrofilos': [
                    /NEUTROFILOS[\s\D]*?(\d+[\.,]?\d*)/i,
                    /SEGMENTADOS[\s\D]*?(\d+[\.,]?\d*)/i,
                    /NEUTROPHILS[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*%.*?NEUTROFILO/i
                ],
                'examLinfocitos': [
                    /LINFOCITOS[\s\D]*?(\d+[\.,]?\d*)/i,
                    /LYMPHOCYTES[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*%.*?LINFOCITO/i
                ],
                'examPlaquetas': [
                    /PLAQUETAS[\s\D]*?(\d+[\.,]?\d*)/i,
                    /PLT[\s\D]*?(\d+[\.,]?\d*)/i,
                    /PLATELET[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*MIL\s*MM3.*?PLAQUETA/i,
                    /(\d+[\.,]?\d*)\s*X\s*10\s*3.*?PLAQUETA/i
                ],
                
                // Bioqu√≠mica
                'examUreia': [
                    /UREIA[\s\D]*?(\d+[\.,]?\d*)/i,
                    /UREA[\s\D]*?(\d+[\.,]?\d*)/i,
                    /BUN[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*MG\s*DL.*?UREIA/i
                ],
                'examCreatinina': [
                    /CREATININA[\s\D]*?(\d+[\.,]?\d*)/i,
                    /CREAT[\s\D]*?(\d+[\.,]?\d*)/i,
                    /CREATININE[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*MG\s*DL.*?CREATININA/i
                ],
                'examSodio': [
                    /SODIO[\s\D]*?(\d+[\.,]?\d*)/i,
                    /SODIUM[\s\D]*?(\d+[\.,]?\d*)/i,
                    /NA[\s\+\-\s]*(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*MEQ\s*L.*?SODIO/i,
                    /(\d+[\.,]?\d*)\s*MMOL\s*L.*?SODIO/i
                ],
                'examPotassio': [
                    /POTASSIO[\s\D]*?(\d+[\.,]?\d*)/i,
                    /POTASSIUM[\s\D]*?(\d+[\.,]?\d*)/i,
                    /K[\s\+\-\s]*(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*MEQ\s*L.*?POTASSIO/i,
                    /(\d+[\.,]?\d*)\s*MMOL\s*L.*?POTASSIO/i
                ],
                'examCalcio': [
                    /CALCIO\s*IONICO[\s\D]*?(\d+[\.,]?\d*)/i,
                    /CALCIUM\s*IONIZED[\s\D]*?(\d+[\.,]?\d*)/i,
                    /CA\s*IONICO[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*MG\s*DL.*?CALCIO.*?IONICO/i
                ],
                
                // Gases arteriais
                'ph': [
                    /PH[\s\D]*?(\d+[\.,]?\d*)/i,
                    /POTENCIAL\s*HIDROGENIONICO[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*UNIDADES.*?PH/i
                ],
                'po2': [
                    /PO2[\s\D]*?(\d+[\.,]?\d*)/i,
                    /PRESSAO\s*PARCIAL\s*OXIGENIO[\s\D]*?(\d+[\.,]?\d*)/i,
                    /OXYGEN[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*MMHG.*?PO2/i
                ],
                'pco2': [
                    /PCO2[\s\D]*?(\d+[\.,]?\d*)/i,
                    /PRESSAO\s*PARCIAL\s*CO2[\s\D]*?(\d+[\.,]?\d*)/i,
                    /DIOXIDO\s*CARBONO[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*MMHG.*?PCO2/i
                ],
                'hco3': [
                    /HCO3[\s\D]*?(\d+[\.,]?\d*)/i,
                    /BICARBONATO[\s\D]*?(\d+[\.,]?\d*)/i,
                    /BICARB[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*MEQ\s*L.*?BICARBONATO/i,
                    /(\d+[\.,]?\d*)\s*MMOL\s*L.*?HCO3/i
                ],
                
                // Outros marcadores
                'lactato': [
                    /LACTATO[\s\D]*?(\d+[\.,]?\d*)/i,
                    /LACTICO[\s\D]*?(\d+[\.,]?\d*)/i,
                    /LACTATE[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*MG\s*DL.*?LACTATO/i,
                    /(\d+[\.,]?\d*)\s*MMOL\s*L.*?LACTATO/i
                ],
                'pcr': [
                    /PROTEINA\s*C\s*REATIVA[\s\D]*?(\d+[\.,]?\d*)/i,
                    /PCR[\s\D]*?(\d+[\.,]?\d*)/i,
                    /C\s*REACTIVE[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*MG\s*L.*?PCR/i,
                    /(\d+[\.,]?\d*)\s*MG\s*DL.*?PROTEINA.*?C.*?REATIVA/i
                ],
                
                // Enzimas hep√°ticas
                'examTgo': [
                    /TGO[\s\D]*?(\d+[\.,]?\d*)/i,
                    /AST[\s\D]*?(\d+[\.,]?\d*)/i,
                    /ASPARTATO\s*AMINOTRANSFERASE[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*U\s*L.*?TGO/i,
                    /(\d+[\.,]?\d*)\s*UI\s*L.*?AST/i
                ],
                'examTgp': [
                    /TGP[\s\D]*?(\d+[\.,]?\d*)/i,
                    /ALT[\s\D]*?(\d+[\.,]?\d*)/i,
                    /ALANINA\s*AMINOTRANSFERASE[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*U\s*L.*?TGP/i,
                    /(\d+[\.,]?\d*)\s*UI\s*L.*?ALT/i
                ],
                'examBilirrubina': [
                    /BILIRRUBINA\s*TOTAL[\s\D]*?(\d+[\.,]?\d*)/i,
                    /BILIRUBIN\s*TOTAL[\s\D]*?(\d+[\.,]?\d*)/i,
                    /BT[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*MG\s*DL.*?BILIRRUBINA.*?TOTAL/i
                ],
                
                // Coagula√ß√£o
                'examTtpa': [
                    /TTPA[\s\D]*?(\d+[\.,]?\d*)/i,
                    /APTT[\s\D]*?(\d+[\.,]?\d*)/i,
                    /TEMPO\s*TROMBOPLASTINA\s*PARCIAL[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*SEGUNDOS.*?TTPA/i
                ],
                'examInr': [
                    /INR[\s\D]*?(\d+[\.,]?\d*)/i,
                    /INTERNATIONAL\s*NORMALIZED\s*RATIO[\s\D]*?(\d+[\.,]?\d*)/i,
                    /(\d+[\.,]?\d*)\s*UNIDADES.*?INR/i
                ]
            };

            // Processar cada mapeamento
            Object.keys(mapeamentos).forEach(campo => {
                const regexArray = mapeamentos[campo];
                let valorEncontrado = null;
                let regexUsada = null;
                
                // Tentar cada regex at√© encontrar um match
                for (const regex of regexArray) {
                    const match = textoNormalizado.match(regex);
                    if (match && match[1]) {
                        valorEncontrado = match[1].replace(',', '.');
                        regexUsada = regex;
                        break;
                    }
                }
                
                if (valorEncontrado) {
                    const elemento = document.getElementById(campo);
                    if (elemento) {
                        // Validar se o valor √© num√©rico e razo√°vel
                        const valor = parseFloat(valorEncontrado);
                        if (!isNaN(valor) && valor > 0 && validarRangeExame(campo, valor)) {
                            elemento.value = formatarValorExame(campo, valorEncontrado);
                            elemento.classList.add('validation-success');
                            setTimeout(() => elemento.classList.remove('validation-success'), 3000);
                            dadosEncontrados++;
                            console.log(`‚úÖ ${campo}: ${valorEncontrado} (regex: ${regexUsada})`);
                        } else {
                            console.log(`‚ö†Ô∏è ${campo}: valor fora do range ${valorEncontrado}`);
                        }
                    } else {
                        console.log(`‚ùå Campo n√£o encontrado: ${campo}`);
                    }
                } else {
                    console.log(`‚ùå N√£o encontrado: ${campo}`);
                }
            });

            console.log(`Total de dados encontrados: ${dadosEncontrados}`);
            
            // Recalcular ap√≥s preencher
            if (dadosEncontrados > 0) {
                calcularTodos();
                gerarSugestoes();
            }
            
            return dadosEncontrados;
        }

        function detectarFormato(texto) {
            if (texto.includes('FLEURY') || texto.includes('GRUPO FLEURY')) return 'fleury';
            if (texto.includes('DASA') || texto.includes('DIAGNOSTICOS DA AMERICA')) return 'dasa';
            if (texto.includes('HERMES PARDINI') || texto.includes('PARDINI')) return 'pardini';
            if (texto.includes('EINSTEIN') || texto.includes('HOSPITAL ISRAELITA')) return 'einstein';
            if (texto.includes('SIRIO LIBANES') || texto.includes('SIRIO-LIBANES')) return 'sirio';
            if (texto.includes('LAVOISIER') || texto.includes('GRUPO LAVOISIER')) return 'lavoisier';
            return 'generico';
        }

        function validarRangeExame(campo, valor) {
            const ranges = {
                'examHemoglobina': [1, 25],
                'examHematocrito': [5, 70],
                'examLeucocitos': [100, 100000],
                'examPlaquetas': [10000, 1000000],
                'examUreia': [5, 500],
                'examCreatinina': [0.1, 20],
                'examSodio': [100, 200],
                'examPotassio': [1, 10],
                'ph': [6.8, 8.0],
                'po2': [20, 600],
                'pco2': [10, 150],
                'hco3': [5, 50],
                'lactato': [0.1, 50],
                'pcr': [0, 500],
                'examTgo': [5, 5000],
                'examTgp': [5, 5000],
                'examBilirrubina': [0.1, 50]
            };
            
            const range = ranges[campo];
            if (!range) return true; // Se n√£o h√° range definido, aceita
            
            return valor >= range[0] && valor <= range[1];
        }

        function formatarValorExame(campo, valor) {
            const numerico = parseFloat(valor);
            
            // Formata√ß√£o espec√≠fica por tipo de exame
            if (['ph'].includes(campo)) {
                return numerico.toFixed(2);
            } else if (['examCreatinina', 'lactato', 'examBilirrubina'].includes(campo)) {
                return numerico.toFixed(1);
            } else if (['examLeucocitos', 'examPlaquetas'].includes(campo)) {
                return Math.round(numerico).toString();
            }
            
            return valor;
        }

        // Gerar sugest√µes autom√°ticas
        function gerarSugestoes() {
            const sugestoes = [];
            
            // An√°lise baseada nos dados preenchidos
            const sofa = parseInt(document.getElementById('sofaScoreTotal').textContent) || 0;
            const lactato = parseFloat(document.getElementById('lactato').value) || 0;
            const pam = parseFloat(document.getElementById('pamCalculada').value) || 0;
            const cr = parseFloat(document.getElementById('cr').value) || 0;
            const febril = document.querySelector('input[name="febril"]:checked')?.value;
            const vasopressor = document.querySelector('input[name="vasopressores[]"]:checked');

            // Sugest√µes baseadas no SOFA
            if (sofa >= 10) {
                sugestoes.push({
                    categoria: "‚ö†Ô∏è Alto Risco",
                    titulo: "SOFA Score Elevado (‚â•10)",
                    itens: [
                        "Considerar objetivos de cuidado com fam√≠lia",
                        "Reavalia√ß√£o de progn√≥stico",
                        "Suporte intensivo m√°ximo"
                    ]
                });
            } else if (sofa >= 6) {
                sugestoes.push({
                    categoria: "‚ö° Aten√ß√£o",
                    titulo: "SOFA Score Moderado (6-9)",
                    itens: [
                        "Monitoriza√ß√£o rigorosa",
                        "Revis√£o de metas terap√™uticas",
                        "Suporte multiorg√¢nico"
                    ]
                });
            }

            // Sugest√µes para lactato elevado
            if (lactato > 4) {
                sugestoes.push({
                    categoria: "üî¥ Cr√≠tico",
                    titulo: "Lactato Elevado (>4)",
                    itens: [
                        "Investigar hipoperfus√£o tecidual",
                        "Ressuscita√ß√£o vol√™mica agressiva",
                        "Considerar vasopressores se necess√°rio",
                        "Reavaliar em 2-4 horas"
                    ]
                });
            } else if (lactato > 2) {
                sugestoes.push({
                    categoria: "üü° Alerta",
                    titulo: "Lactato Borderline (2-4)",
                    itens: [
                        "Monitorizar tend√™ncia",
                        "Otimizar perfus√£o",
                        "Reavaliar em 4-6 horas"
                    ]
                });
            }

            // Sugest√µes para disfun√ß√£o renal
            if (cr > 3.5) {
                sugestoes.push({
                    categoria: "üíß Renal",
                    titulo: "Disfun√ß√£o Renal Severa",
                    itens: [
                        "Considerar terapia de substitui√ß√£o renal",
                        "Ajustar doses de medicamentos",
                        "Controle rigoroso de balan√ßo h√≠drico",
                        "Evitar nefrot√≥xicos"
                    ]
                });
            }

            // Sugest√µes para sepse
            if (febril === "sim" && lactato > 2) {
                sugestoes.push({
                    categoria: "ü¶† Infeccioso",
                    titulo: "Suspeita de Sepse",
                    itens: [
                        "Protocolo de sepse: 1¬™ hora",
                        "Coleta de culturas (hemoculturas, urocultura)",
                        "Antibioticoterapia emp√≠rica",
                        "Ressuscita√ß√£o vol√™mica 30ml/kg",
                        "Controle de foco se identificado"
                    ]
                });
            }

            // Sugest√µes para instabilidade hemodin√¢mica
            if (vasopressor) {
                sugestoes.push({
                    categoria: "üíì Hemodin√¢mica",
                    titulo: "Em Uso de Vasopressor",
                    itens: [
                        "Meta: PAM 65-70 mmHg (ou maior se HAS pr√©via)",
                        "Monitorizar lactato seriado",
                        "Avaliar volemia (ultrassom, PVC)",
                        "Desmame gradual conforme estabiliza√ß√£o"
                    ]
                });
            }

            // Renderizar sugest√µes
            renderizarSugestoes(sugestoes);
        }

        function renderizarSugestoes(sugestoes) {
            const container = document.getElementById('autoSuggestions');
            
            if (sugestoes.length === 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.7;">Preencha mais dados para receber sugest√µes autom√°ticas</p>';
                return;
            }

            container.innerHTML = sugestoes.map(sugestao => `
                <div class="suggestion-item">
                    <h4>${sugestao.categoria}: ${sugestao.titulo}</h4>
                    <ul>
                        ${sugestao.itens.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                </div>
            `).join('');
        }

        // Configurar campos condicionais e c√°lculos
        document.addEventListener('DOMContentLoaded', function() {
            configurarUpload();
            configurarAtalhosTeclado();
            configurarValidacaoTempo();
            configurarSalvamentoAutomatico();

            // Campos condicionais existentes
            toggleConditionalField('tipoDiretiva', 'proporcionalidade', 'conferenciaFields');
            toggleConditionalField('tipoDiretiva', 'paliativo', 'conferenciaFields');
            toggleConditionalField('temAlergias', 'sim', 'alergiasFields');
            toggleConditionalField('temSecrecao', 'sim', 'secrecaoFields');
            toggleConditionalField('evacuacao', 'nao', 'evacuacaoFields');
            toggleConditionalField('profilaxiaGastrica', 'sim', 'profilaxiaGastricaFields');
            toggleConditionalField('dialise', 'sim', 'dialiseFields');
            toggleConditionalField('endocrinopatia', 'sim', 'endocrinoDetails');
            toggleConditionalField('corticoide', 'sim', 'corticoideDetails');
            toggleConditionalField('profilaxiaTev', 'sim', 'profilaxiaTevFields');
            toggleConditionalField('profilaxiaTev', 'nao', 'contraindicacaoTevFields');
            toggleConditionalField('sangramento', 'sim', 'sangramentoDetails');
            toggleConditionalField('transfusoes', 'sim', 'transfusoesFields');
            toggleConditionalField('febril', 'sim', 'febrilFields');
            toggleConditionalField('sepse', 'sim', 'sepseDetails');
            toggleConditionalField('hemocultura', 'sim', 'hemoculturaFields');
            toggleConditionalField('urocultura', 'sim', 'uroculturaFields');
            toggleConditionalField('lesoesPressao', 'sim', 'lesoesDetails');
            toggleConditionalField('shilley', 'sim', 'shilleyFields');
            toggleConditionalField('paInvasiva', 'sim', 'paInvasivaFields');
            
            // ... (todos os outros campos condicionais j√° implementados)

            // Suporte respirat√≥rio
            const suporteResp = document.getElementById('suporteResp');
            const vmFields = document.getElementById('vmFields');
            const vmModo = document.getElementById('vmModo');
            const psvFields = document.getElementById('psvFields');
            const cateterFields = document.getElementById('cateterFields');
            const mascaraFields = document.getElementById('mascaraFields');
            
            suporteResp.addEventListener('change', function() {
                vmFields.classList.remove('show');
                psvFields.classList.remove('show');
                cateterFields.classList.remove('show');
                mascaraFields.classList.remove('show');
                
                if (this.value === 'vm_iot') {
                    vmFields.classList.add('show');
                } else if (this.value === 'cateter_o2') {
                    cateterFields.classList.add('show');
                } else if (this.value === 'mascara_o2') {
                    mascaraFields.classList.add('show');
                }
                gerarSugestoes();
            });
            
            vmModo.addEventListener('change', function() {
                if (this.value === 'psv') {
                    psvFields.classList.add('show');
                } else {
                    psvFields.classList.remove('show');
                }
            });
            
            // Dispositivos
            const acessoPeriferico = document.getElementById('acessoPeriferico');
            const acessoCentral = document.getElementById('acessoCentral');
            const acessoPerifericoFields = document.getElementById('acessoPerifericoFields');
            const acessoCentralFields = document.getElementById('acessoCentralFields');
            const tot = document.getElementById('tot');
            const sne = document.getElementById('sne');
            const totFields = document.getElementById('totFields');
            const sneFields = document.getElementById('sneFields');
            
            acessoPeriferico.addEventListener('change', function() {
                if (this.checked) {
                    acessoPerifericoFields.classList.add('show');
                } else {
                    acessoPerifericoFields.classList.remove('show');
                }
            });
            
            acessoCentral.addEventListener('change', function() {
                if (this.checked) {
                    acessoCentralFields.classList.add('show');
                } else {
                    acessoCentralFields.classList.remove('show');
                }
            });
            
            tot.addEventListener('change', function() {
                if (this.checked) {
                    totFields.classList.add('show');
                } else {
                    totFields.classList.remove('show');
                }
            });
            
            sne.addEventListener('change', function() {
                if (this.checked) {
                    sneFields.classList.add('show');
                } else {
                    sneFields.classList.remove('show');
                }
            });
            
            // Continuar com todos os campos condicionais...
            // (c√≥digo dos campos condicionais j√° existente)

            // Calcular Glasgow automaticamente
            const glasgowOcular = document.getElementById('glasgowOcular');
            const glasgowVerbal = document.getElementById('glasgowVerbal');
            const glasgowMotor = document.getElementById('glasgowMotor');
            const glasgowTotal = document.getElementById('glasgowTotal');
            
            function calcularGlasgow() {
                const ocular = parseInt(glasgowOcular.value) || 0;
                const verbal = parseInt(glasgowVerbal.value) || 0;
                const motor = parseInt(glasgowMotor.value) || 0;
                
                if (ocular > 0 && verbal > 0 && motor > 0) {
                    glasgowTotal.value = ocular + verbal + motor;
                } else {
                    glasgowTotal.value = '';
                }
                calcularSOFA();
                gerarSugestoes();
            }
            
            glasgowOcular.addEventListener('change', calcularGlasgow);
            glasgowVerbal.addEventListener('change', calcularGlasgow);
            glasgowMotor.addEventListener('change', calcularGlasgow);
            
            // Calcular PAM automaticamente
            const pasSistolica = document.getElementById('pasSistolica');
            const pasDiastolica = document.getElementById('pasDiastolica');
            const pamCalculada = document.getElementById('pamCalculada');
            
            function calcularPAM() {
                const sistolica = parseFloat(pasSistolica.value) || 0;
                const diastolica = parseFloat(pasDiastolica.value) || 0;
                
                if (sistolica > 0 && diastolica > 0) {
                    const pam = ((sistolica + (2 * diastolica)) / 3).toFixed(1);
                    pamCalculada.value = pam;
                } else {
                    pamCalculada.value = '';
                }
                calcularSOFA();
                gerarSugestoes();
            }
            
            pasSistolica.addEventListener('input', calcularPAM);
            pasDiastolica.addEventListener('input', calcularPAM);
            
            // Calcular rela√ß√£o pO2/FiO2
            const po2Input = document.getElementById('po2');
            const fio2Input = document.getElementById('fio2');
            const relacaoPoFio = document.getElementById('relacaoPoFio');
            
            function calcularRelacaoPoFio2() {
                const po2 = parseFloat(po2Input.value) || 0;
                const fio2 = parseFloat(fio2Input.value) || 0;
                
                if (po2 > 0 && fio2 > 0) {
                    const fio2Decimal = fio2 > 1 ? fio2 / 100 : fio2;
                    const relacao = (po2 / fio2Decimal).toFixed(1);
                    relacaoPoFio.value = relacao;
                } else {
                    relacaoPoFio.value = '';
                }
                calcularSOFA();
                gerarSugestoes();
            }
            
            po2Input.addEventListener('input', calcularRelacaoPoFio2);
            fio2Input.addEventListener('input', calcularRelacaoPoFio2);
            
            // Adicionar listeners para todos os campos que afetam SOFA
            ['cr', 'diurese24h', 'examBilirrubina', 'examPlaquetas', 'lactato'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', () => {
                        calcularSOFA();
                        gerarSugestoes();
                        atualizarProgresso();
                    });
                }
            });

            // Adicionar listeners para todos os inputs para atualizar progresso
            document.querySelectorAll('input, select, textarea').forEach(element => {
                element.addEventListener('input', atualizarProgresso);
                element.addEventListener('change', atualizarProgresso);
            });

            // Inicializar
            atualizarProgresso();
            gerarSugestoes();
        });

        // Calcular SOFA Score
        function calcularSOFA() {
            let sofa = 0;
            
            // Respirat√≥rio (pO2/FiO2)
            const po2fio2 = parseFloat(document.getElementById('relacaoPoFio').value) || 0;
            if (po2fio2 > 0) {
                if (po2fio2 < 100) sofa += 4;
                else if (po2fio2 < 200) sofa += 3;
                else if (po2fio2 < 300) sofa += 2;
                else if (po2fio2 < 400) sofa += 1;
            }
            
            // Cardiovascular (PAM ou vasopressores)
            const pam = parseFloat(document.getElementById('pamCalculada').value) || 0;
            const temVasopressor = document.querySelector('input[name="vasopressores[]"]:checked');
            const noradrenalina = parseFloat(document.getElementById('doseVasoNoradrenalina').value) || 0;
            
            if (noradrenalina > 0.1) sofa += 4;
            else if (noradrenalina > 0.1 || temVasopressor) sofa += 3;
            else if (pam < 70) sofa += 1;
            
            // Neurol√≥gico (Glasgow)
            const glasgow = parseInt(document.getElementById('glasgowTotal').value) || 15;
            if (glasgow < 6) sofa += 4;
            else if (glasgow < 10) sofa += 3;
            else if (glasgow < 13) sofa += 2;
            else if (glasgow < 15) sofa += 1;
            
            // Renal (Creatinina e diurese)
            const creatinina = parseFloat(document.getElementById('cr').value) || 0;
            const diurese = parseFloat(document.getElementById('diurese24h').value) || 0;
            
            if (creatinina >= 5 || diurese < 200) sofa += 4;
            else if (creatinina >= 3.5 || diurese < 500) sofa += 3;
            else if (creatinina >= 2) sofa += 2;
            else if (creatinina >= 1.2) sofa += 1;
            
            // Hep√°tico (Bilirrubina)
            const bilirrubina = parseFloat(document.getElementById('examBilirrubina').value) || 0;
            if (bilirrubina >= 12) sofa += 4;
            else if (bilirrubina >= 6) sofa += 3;
            else if (bilirrubina >= 2) sofa += 2;
            else if (bilirrubina >= 1.2) sofa += 1;
            
            // Coagula√ß√£o (Plaquetas)
            const plaquetas = parseFloat(document.getElementById('examPlaquetas').value) || 0;
            if (plaquetas > 0) {
                if (plaquetas < 20) sofa += 4;
                else if (plaquetas < 50) sofa += 3;
                else if (plaquetas < 100) sofa += 2;
                else if (plaquetas < 150) sofa += 1;
            }
            
            document.getElementById('sofaScoreTotal').textContent = sofa;
        }

        // Atalhos de teclado
        function configurarAtalhosTeclado() {
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey) {
                    switch(e.key) {
                        case 'd':
                            e.preventDefault();
                            toggleDashboard();
                            break;
                        case 'f':
                            e.preventDefault();
                            autoPreenchimento();
                            break;
                        case 'c':
                            e.preventDefault();
                            calcularTodos();
                            break;
                        case 'v':
                            e.preventDefault();
                            validarFormulario();
                            break;
                        case 's':
                            e.preventDefault();
                            salvarRascunho();
                            break;
                        case 'h':
                            e.preventDefault();
                            toggleAtalhos();
                            break;
                        case 'l':
                            e.preventDefault();
                            if (confirm('Tem certeza que deseja limpar o formul√°rio?')) {
                                limparFormulario();
                            }
                            break;
                    }
                }
            });
        }

        // Fun√ß√µes utilit√°rias
        function calcularTodos() {
            // Executar todos os c√°lculos
            const events = ['input', 'change'];
            
            // Trigger Glasgow
            document.getElementById('glasgowOcular').dispatchEvent(new Event('change'));
            
            // Trigger PAM
            document.getElementById('pasSistolica').dispatchEvent(new Event('input'));
            
            // Trigger pO2/FiO2
            document.getElementById('po2').dispatchEvent(new Event('input'));
            
            calcularSOFA();
            gerarSugestoes();
        }

        function validarFormulario() {
            let erros = 0;
            const camposObrigatorios = ['nome', 'idade', 'dataInternacao'];
            
            camposObrigatorios.forEach(campo => {
                const elemento = document.getElementById(campo);
                if (!elemento.value.trim()) {
                    elemento.classList.add('validation-error');
                    erros++;
                } else {
                    elemento.classList.remove('validation-error');
                    elemento.classList.add('validation-success');
                }
            });
            
            if (erros === 0) {
                alert('‚úÖ Formul√°rio validado com sucesso!');
            } else {
                alert(`‚ùå Encontrados ${erros} erro(s). Verifique os campos destacados.`);
            }
            
            setTimeout(() => {
                document.querySelectorAll('.validation-error, .validation-success').forEach(el => {
                    el.classList.remove('validation-error', 'validation-success');
                });
            }, 3000);
        }

        function autoPreenchimento() {
            // Preencher dados b√°sicos simulados
            if (!document.getElementById('nome').value) {
                document.getElementById('nome').value = 'Paciente UTI';
            }
            if (!document.getElementById('idade').value) {
                document.getElementById('idade').value = '65';
            }
            if (!document.getElementById('dataInternacao').value) {
                document.getElementById('dataInternacao').value = new Date().toISOString().split('T')[0];
            }
            
            // Preencher dados vitais simulados
            if (!document.getElementById('pasSistolica').value) {
                document.getElementById('pasSistolica').value = '120';
                document.getElementById('pasDiastolica').value = '80';
                document.getElementById('pasSistolica').dispatchEvent(new Event('input'));
            }
            
            if (!document.getElementById('fc').value) {
                document.getElementById('fc').value = '85';
            }
            
            atualizarProgresso();
            calcularTodos();
        }

        function limparFormulario() {
            document.getElementById('evolucaoForm').reset();
            document.querySelectorAll('.conditional-field').forEach(field => {
                field.classList.remove('show');
            });
            atualizarProgresso();
            gerarSugestoes();
        }

        function toggleAtalhos() {
            const shortcuts = document.getElementById('keyboardShortcuts');
            shortcuts.style.display = shortcuts.style.display === 'none' ? 'block' : 'none';
        }

        function atualizarProgresso() {
            const campos = document.querySelectorAll('input, select, textarea');
            let preenchidos = 0;
            let total = 0;
            
            campos.forEach(campo => {
                if (campo.type !== 'button' && campo.type !== 'submit' && !campo.readOnly) {
                    total++;
                    if (campo.value && campo.value.trim() !== '') {
                        preenchidos++;
                    }
                }
            });
            
            const porcentagem = Math.round((preenchidos / total) * 100);
            document.getElementById('progressFill').style.width = porcentagem + '%';
        }

        function mostrarIndicadorSave() {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);
        }

        function configurarValidacaoTempo() {
            document.querySelectorAll('input, select, textarea').forEach(elemento => {
                elemento.addEventListener('input', () => {
                    clearTimeout(validationTimer);
                    validationTimer = setTimeout(() => {
                        // Valida√ß√£o em tempo real aqui
                        if (elemento.value && elemento.checkValidity()) {
                            elemento.style.borderColor = '#27ae60';
                        }
                    }, 500);
                });
            });
        }

        function configurarSalvamentoAutomatico() {
            document.querySelectorAll('input, select, textarea').forEach(elemento => {
                elemento.addEventListener('input', () => {
                    clearTimeout(autoSaveTimer);
                    autoSaveTimer = setTimeout(() => {
                        salvarRascunho(true);
                    }, 5000);
                });
            });
        }

        function salvarRascunho(automatico = false) {
            // Simular salvamento (na pr√°tica seria enviado para servidor)
            const formData = new FormData(document.getElementById('evolucaoForm'));
            const dados = {};
            
            for (let [key, value] of formData.entries()) {
                dados[key] = value;
            }
            
            // Simular salvamento local
            console.log('Rascunho salvo:', dados);
            
            if (!automatico) {
                mostrarIndicadorSave();
            }
        }

        // Gerar documento DOCX
        async function gerarDocumentoWord() {
            const formData = new FormData(document.getElementById('evolucaoForm'));
            const dados = {};
            
            for (let [key, value] of formData.entries()) {
                if (dados[key]) {
                    if (Array.isArray(dados[key])) {
                        dados[key].push(value);
                    } else {
                        dados[key] = [dados[key], value];
                    }
                } else {
                    dados[key] = value;
                }
            }

            // Criar documento usando docx
            const doc = new docx.Document({
                sections: [{
                    properties: {},
                    children: [
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: "EVOLU√á√ÉO M√âDICA - UTI",
                                bold: true,
                                size: 28,
                            })],
                            alignment: docx.AlignmentType.CENTER,
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun("")],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: `Data: ${new Date().toLocaleDateString('pt-BR')}`,
                                italics: true,
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun("")],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: "DADOS DE IDENTIFICA√á√ÉO",
                                bold: true,
                                underline: {},
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: `Nome: ${dados.nome || 'N√£o informado'}`,
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: `Idade: ${dados.idade || 'N√£o informado'} anos`,
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: `Data de Interna√ß√£o: ${dados.dataInternacao || 'N√£o informado'}`,
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun("")],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: "EVOLU√á√ÉO DO DIA",
                                bold: true,
                                underline: {},
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: dados.evolucaoDia || 'N√£o informado',
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun("")],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: "AVALIA√á√ÉO CL√çNICA",
                                bold: true,
                                underline: {},
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: `SOFA Score: ${document.getElementById('sofaScoreTotal').textContent}`,
                                bold: true,
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: `Glasgow: ${dados.glasgowTotal || 'N√£o avaliado'}`,
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: `PAM: ${dados.pamCalculada || 'N√£o calculado'} mmHg`,
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: `Rela√ß√£o pO2/FiO2: ${dados.relacaoPoFio || 'N√£o calculado'}`,
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun("")],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: "CONDUTA E PRESCRI√á√ÉO",
                                bold: true,
                                underline: {},
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: dados.condutaGeral || 'N√£o informado',
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun("")],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: "PRESCRI√á√ÉO M√âDICA",
                                bold: true,
                                underline: {},
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: dados.prescricaoMedica || 'N√£o informado',
                            })],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun("")],
                        }),
                        new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: `Documento gerado automaticamente em ${new Date().toLocaleString('pt-BR')}`,
                                italics: true,
                                size: 20,
                            })],
                            alignment: docx.AlignmentType.CENTER,
                        }),
                    ],
                }],
            });

            // Salvar arquivo
            const blob = await docx.Packer.toBlob(doc);
            const nomeArquivo = `Evolucao_UTI_${dados.nome?.replace(/\s+/g, '_') || 'Paciente'}_${new Date().toISOString().split('T')[0]}.docx`;
            saveAs(blob, nomeArquivo);
        }

        // Submiss√£o do formul√°rio
        document.getElementById('evolucaoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            gerarDocumentoWord();
        });

        // Adicionar efeitos visuais suaves
        document.querySelectorAll('.section').forEach(section => {
            section.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-2px)';
            });
            
            section.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
    </script>
</body>
</html>
